{% extends "portal_cidadao/base.html" %}

{% block title %}Nova Reclamação - Portal do Cidadão{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-4">
                    <i class="fas fa-comment me-3"></i>
                    Nova Reclamação
                </h1>
                <p class="lead mb-4">
                    Faça sua reclamação de forma rápida e segura. Nossa equipe analisará seu caso 
                    e entrará em contato com a empresa para buscar uma solução.
                </p>
                <div class="d-flex gap-3">
                    <a href="{% url 'portal_cidadao:orientacoes' %}" class="btn btn-light btn-lg">
                        <i class="fas fa-info-circle me-2"></i>Orientações
                    </a>
                    <a href="{% url 'portal_cidadao:faq' %}" class="btn btn-outline-light btn-lg">
                        <i class="fas fa-question-circle me-2"></i>Dúvidas
                    </a>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <i class="fas fa-clipboard-list" style="font-size: 8rem; opacity: 0.3;"></i>
            </div>
        </div>
    </div>
</section>

<!-- Formulário de Reclamação -->
<section class="py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">
                            <i class="fas fa-edit me-2 text-primary"></i>
                            Formulário de Reclamação
                        </h4>
                    </div>
                    <div class="card-body">
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                        
                        <form method="post" enctype="multipart/form-data" id="formReclamacao">
                            {% csrf_token %}
                            
                            <!-- Dados Pessoais -->
                            <h5 class="mb-3">
                                <i class="fas fa-user me-2 text-primary"></i>
                                Dados Pessoais
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nome" class="form-label">Nome Completo *</label>
                                    <input type="text" class="form-control" id="nome" name="nome" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="cpf" class="form-label">CPF *</label>
                                    <input type="text" class="form-control" id="cpf" name="cpf" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">E-mail *</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="telefone" class="form-label">Telefone *</label>
                                    <input type="tel" class="form-control" id="telefone" name="telefone" required>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="endereco" class="form-label">Endereço Completo *</label>
                                <textarea class="form-control" id="endereco" name="endereco" rows="3" required></textarea>
                            </div>
                            
                            <hr class="my-4">
                            
                            <!-- Dados da Empresa -->
                            <h5 class="mb-3">
                                <i class="fas fa-building me-2 text-primary"></i>
                                Dados da Empresa
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label for="empresa" class="form-label">Nome da Empresa/Estabelecimento *</label>
                                    <input type="text" class="form-control" id="empresa" name="empresa" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="cnpj" class="form-label">CNPJ</label>
                                    <input type="text" class="form-control" id="cnpj" name="cnpj">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="endereco_empresa" class="form-label">Endereço da Empresa</label>
                                <textarea class="form-control" id="endereco_empresa" name="endereco_empresa" rows="2"></textarea>
                            </div>
                            
                            <hr class="my-4">
                            
                            <!-- Detalhes da Reclamação -->
                            <h5 class="mb-3">
                                <i class="fas fa-exclamation-triangle me-2 text-primary"></i>
                                Detalhes da Reclamação
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="tipo_problema" class="form-label">Tipo de Problema *</label>
                                    <select class="form-select" id="tipo_problema" name="tipo_problema" required>
                                        <option value="">Selecione o tipo de problema</option>
                                        <option value="PRODUTO_DEFEITUOSO">Produto com Defeito</option>
                                        <option value="SERVICO_NAO_PRESTADO">Serviço Não Prestado</option>
                                        <option value="COBRANCA_INDEVIDA">Cobrança Indevida</option>
                                        <option value="PUBLICIDADE_ENGANOSA">Publicidade Enganosa</option>
                                        <option value="ATENDIMENTO_RUIM">Mau Atendimento</option>
                                        <option value="GARANTIA_NEGADA">Garantia Negada</option>
                                        <option value="OUTROS">Outros</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="data_ocorrencia" class="form-label">Data da Ocorrência *</label>
                                    <input type="date" class="form-control" id="data_ocorrencia" name="data_ocorrencia" required>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="descricao" class="form-label">Descrição Detalhada do Problema *</label>
                                <textarea class="form-control" id="descricao" name="descricao" rows="5" required 
                                          placeholder="Descreva detalhadamente o que aconteceu, incluindo datas, valores, tentativas de resolução, etc."></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="pedido" class="form-label">O que você está pedindo? *</label>
                                <textarea class="form-control" id="pedido" name="pedido" rows="3" required 
                                          placeholder="Ex: Devolução do dinheiro, troca do produto, cancelamento do serviço, etc."></textarea>
                            </div>
                            
                            <hr class="my-4">
                            
                            <!-- Documentos -->
                            <h5 class="mb-3">
                                <i class="fas fa-paperclip me-2 text-primary"></i>
                                Documentos (Opcional)
                            </h5>
                            
                            <div class="mb-3">
                                <label for="documentos" class="form-label">Anexar Documentos</label>
                                <input type="file" class="form-control" id="documentos" name="documentos" multiple>
                                <div class="form-text">
                                    Você pode anexar: notas fiscais, recibos, contratos, fotos, etc. (Máximo 5MB por arquivo)
                                </div>
                            </div>
                            
                            <hr class="my-4">
                            
                            <!-- Termos -->
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="concordo" name="concordo" required>
                                    <label class="form-check-label" for="concordo">
                                        Concordo com o tratamento dos meus dados pessoais conforme a 
                                        <a href="#" class="text-decoration-none">Política de Privacidade</a> *
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="veracidade" name="veracidade" required>
                                    <label class="form-check-label" for="veracidade">
                                        Declaro que as informações fornecidas são verdadeiras *
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Botões -->
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="reset" class="btn btn-secondary btn-lg">
                                    <i class="fas fa-undo me-2"></i>Limpar
                                </button>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-paper-plane me-2"></i>Enviar Reclamação
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Dicas -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-lightbulb me-2 text-primary"></i>
                            Dicas para uma Reclamação Eficaz
                        </h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Seja específico e detalhado
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Inclua datas e valores
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Anexe documentos comprobatórios
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Descreva as tentativas de resolução
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Seja objetivo no seu pedido
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- Informações -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle me-2 text-primary"></i>
                            Informações Importantes
                        </h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Prazo de Análise:</strong> Até 30 dias úteis</p>
                        <p><strong>Contato:</strong> Você será notificado por e-mail</p>
                        <p><strong>Gratuito:</strong> Não há custos para fazer reclamações</p>
                        <p><strong>Confidencial:</strong> Seus dados são protegidos</p>
                    </div>
                </div>
                
                <!-- Links Úteis -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-external-link-alt me-2 text-primary"></i>
                            Links Úteis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="{% url 'portal_cidadao:orientacoes' %}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-info-circle me-1"></i>Orientações
                            </a>
                            <a href="{% url 'portal_cidadao:faq' %}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-question-circle me-1"></i>Perguntas Frequentes
                            </a>
                            <a href="{% url 'portal_cidadao:formularios' %}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-download me-1"></i>Formulários
                            </a>
                            <a href="{% url 'portal_cidadao:contato' %}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-envelope me-1"></i>Fale Conosco
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-5 bg-primary text-white">
    <div class="container text-center">
        <h2 class="mb-4">Precisa de Ajuda?</h2>
        <p class="lead mb-4">
            Nossa equipe está pronta para orientá-lo sobre como fazer uma reclamação eficaz.
        </p>
        <div class="d-flex justify-content-center gap-3 flex-wrap">
            <a href="{% url 'portal_cidadao:orientacoes' %}" class="btn btn-light btn-lg">
                <i class="fas fa-info-circle me-2"></i>Orientações
            </a>
            <a href="{% url 'portal_cidadao:faq' %}" class="btn btn-outline-light btn-lg">
                <i class="fas fa-question-circle me-2"></i>Perguntas Frequentes
            </a>
            <a href="{% url 'portal_cidadao:contato' %}" class="btn btn-outline-light btn-lg">
                <i class="fas fa-envelope me-2"></i>Fale Conosco
            </a>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Máscara para CPF
document.getElementById('cpf').addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/(\d{3})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    e.target.value = value;
});

// Máscara para CNPJ
document.getElementById('cnpj').addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/^(\d{2})(\d)/, '$1.$2');
    value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
    value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
    value = value.replace(/(\d{4})(\d)/, '$1-$2');
    e.target.value = value;
});

// Máscara para telefone
document.getElementById('telefone').addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length <= 10) {
        value = value.replace(/(\d{2})(\d)/, '($1) $2');
        value = value.replace(/(\d{4})(\d)/, '$1-$2');
    } else {
        value = value.replace(/(\d{2})(\d)/, '($1) $2');
        value = value.replace(/(\d{5})(\d)/, '$1-$2');
    }
    e.target.value = value;
});

// Validação do formulário
document.getElementById('formReclamacao').addEventListener('submit', function (e) {
    const requiredFields = this.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.classList.add('is-invalid');
            isValid = false;
        } else {
            field.classList.remove('is-invalid');
        }
    });
    
    if (!isValid) {
        e.preventDefault();
        alert('Por favor, preencha todos os campos obrigatórios.');
    }
});
</script>
{% endblock %}
