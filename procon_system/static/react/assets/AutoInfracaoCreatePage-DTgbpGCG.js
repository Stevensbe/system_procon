import{j as e,C as I}from"./main-DVdFXPbZ.js";import{u as O,r as x,L as P}from"./router-C15yhWin.js";import{S as A,F as R}from"./FileUpload-CIYprfM2.js";import"./vendor-Csw2ODfV.js";import"./icons-C8WIGuh4.js";function V(){const C=O(),[b,h]=x.useState(!1),[v,p]=x.useState(""),[o,j]=x.useState({data_fiscalizacao:new Date().toISOString().split("T")[0],hora_fiscalizacao:new Date().toTimeString().split(" ")[0].substring(0,5),municipio:"MANAUS",estado:"AMAZONAS",razao_social:"",nome_fantasia:"",atividade:"",endereco:"",cnpj:"",telefone:"",parecer_numero:"",parecer_origem:"FISCALIZAÇÃO/PROCON/AM",relatorio:"",base_legal_cdc:"",base_legal_outras:"",infracao_art_34:!1,infracao_art_35:!1,infracao_art_36:!1,infracao_art_55:!1,infracao_art_56:!1,infracao_publicidade_enganosa:!1,infracao_precos_abusivos:!1,infracao_produtos_vencidos:!1,infracao_falta_informacao:!1,outras_infracoes:"",fundamentacao_tecnica:"",fundamentacao_juridica:"",valor_multa:"",responsavel_nome:"",responsavel_cpf:"",responsavel_funcao:"",fiscal_nome:"",fiscal_cargo:"Agente de Fiscalização",estabelecimento_responsavel:"",data_notificacao:"",data_vencimento:"",status:"autuado",possui_anexo:!1,descricao_anexo:"",observacoes:""}),[m,F]=x.useState({assinatura_fiscal:"",assinatura_responsavel:""}),[f,w]=x.useState([]),u=a=>{const{name:r,value:d,type:s,checked:t}=a.target;j(s==="checkbox"?c=>({...c,[r]:t}):c=>({...c,[r]:d}))},N=(a,r)=>{F(d=>({...d,[a]:r}))},S=a=>{w(a)},z=(a,r)=>{var d;try{if(!a||typeof a!="string"||!a.includes("data:image/"))return null;const s=a.split(",");if(s.length!==2)throw new Error("Formato base64 inválido");const t=(d=s[0].match(/:(.*?);/))==null?void 0:d[1];if(!t)throw new Error("MIME type não encontrado");const c=atob(s[1]),_=c.length,y=new Uint8Array(_);for(let g=0;g<_;g++)y[g]=c.charCodeAt(g);return new File([y],r,{type:t})}catch(s){return console.error(`Erro ao converter assinatura ${r}:`,s),null}},k=async a=>{if(a.preventDefault(),h(!0),p(""),!o.razao_social||!o.cnpj||!o.relatorio||!o.valor_multa){p("Preencha todos os campos obrigatórios"),h(!1);return}try{const r=new FormData;Object.keys(o).forEach(s=>{const t=o[s];typeof t=="boolean"?r.append(s,t?"true":"false"):t!=null&&r.append(s,String(t))}),Object.keys(m).forEach(s=>{if(m[s]){const t=z(m[s],`${s}.png`);t&&r.append(s,t)}}),f&&f.length>0&&f.forEach((s,t)=>{s&&s.file instanceof File&&(r.append("anexos",s.file),r.append(`anexo_descricao_${t}`,s.name||s.file.name))});const d=await I(r);alert(`Auto de Infração "${d.numero}" criado com sucesso!`),C("/fiscalizacao/infracoes")}catch(r){console.error("Erro ao salvar:",r),p(r.message||"Ocorreu um erro ao salvar o auto de infração.")}finally{h(!1)}},l=(a,r,d="text",s=!1,t=null)=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:a,className:"block text-sm font-medium text-gray-700",children:[r," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:d,id:a,name:a,value:o[a],onChange:u,required:s,maxLength:t,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500"})]}),n=(a,r,d=3,s=!1)=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:a,className:"block text-sm font-medium text-gray-700",children:[r," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:a,name:a,value:o[a],onChange:u,required:s,rows:d,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500"})]}),i=(a,r,d="")=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("input",{type:"checkbox",id:a,name:a,checked:o[a],onChange:u,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded mt-1"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("label",{htmlFor:a,className:"block text-sm text-gray-700",children:r}),d&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:d})]})]}),D=(a,r,d,s=!1)=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:a,className:"block text-sm font-medium text-gray-700",children:[r," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:a,name:a,value:o[a],onChange:u,required:s,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),d.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),E=[{value:"autuado",label:"Autuado"},{value:"notificado",label:"Notificado"},{value:"em_defesa",label:"Em Defesa"},{value:"julgado",label:"Julgado"},{value:"pago",label:"Pago"},{value:"cancelado",label:"Cancelado"}];return e.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-red-600 px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Novo Auto de Infração"}),e.jsxs("p",{className:"text-red-100 mt-1",children:["Número: ",e.jsx("span",{className:"font-mono bg-red-700 px-2 py-1 rounded text-sm",children:"Gerado Automaticamente"})]})]}),e.jsxs("form",{onSubmit:k,className:"p-6 space-y-8",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"1"}),"Dados Básicos"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[l("data_fiscalizacao","Data da Fiscalização","date",!0),l("hora_fiscalizacao","Hora da Fiscalização","time",!0),l("municipio","Município","text",!0),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),e.jsx("input",{type:"text",value:"AMAZONAS",disabled:!0,className:"mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md text-gray-500"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"2"}),"Dados do Estabelecimento"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[l("razao_social","Razão Social","text",!0,255),l("nome_fantasia","Nome Fantasia","text",!1,255),l("atividade","Atividade","text",!0,255),l("endereco","Endereço","text",!0,500),l("cnpj","CNPJ","text",!0,18),l("telefone","Telefone","tel",!1,20)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"3"}),"Parecer Prévio"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l("parecer_numero","Número do Parecer","text",!1,50),l("parecer_origem","Origem do Parecer","text",!1,100)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"4"}),"Relatório"]}),n("relatorio","Relatório Detalhado",8,!0),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Orientação:"})," Descreva detalhadamente os fatos constatados durante a fiscalização, incluindo evidências, testemunhas e circunstâncias relevantes para a autuação."]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"5"}),"Base Legal"]}),e.jsxs("div",{className:"space-y-4",children:[n("base_legal_cdc","Artigos do CDC violados",4,!0),n("base_legal_outras","Outras bases legais",4)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"6"}),"Infrações Constatadas"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Artigos do CDC"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i("infracao_art_34","Art. 34 CDC","Informação adequada e clara"),i("infracao_art_35","Art. 35 CDC","Publicidade enganosa"),i("infracao_art_36","Art. 36 CDC","Publicidade abusiva"),i("infracao_art_55","Art. 55 CDC","Oferta inadequada"),i("infracao_art_56","Art. 56 CDC","Recusa de venda")]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Outras Infrações"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i("infracao_publicidade_enganosa","Publicidade Enganosa"),i("infracao_precos_abusivos","Preços Abusivos"),i("infracao_produtos_vencidos","Produtos Vencidos"),i("infracao_falta_informacao","Falta de Informação")]})]}),n("outras_infracoes","Outras infrações específicas",4)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"7"}),"Fundamentação"]}),e.jsxs("div",{className:"space-y-4",children:[n("fundamentacao_tecnica","Fundamentação Técnica",4),n("fundamentacao_juridica","Fundamentação Jurídica",4)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"8"}),"Penalidade"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l("valor_multa","Valor da Multa (R$)","number",!0),D("status","Status",E,!0),l("data_notificacao","Data de Notificação","date"),l("data_vencimento","Data de Vencimento","date")]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"9"}),"Responsáveis"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Autoridade Fiscalizadora"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l("fiscal_nome","Nome do Fiscal","text",!0,255),l("fiscal_cargo","Cargo do Fiscal","text",!0,100)]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Estabelecimento Fiscalizado"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[l("responsavel_nome","Nome do Responsável","text",!0,255),l("responsavel_cpf","CPF do Responsável","text",!0,14),l("responsavel_funcao","Função/Cargo","text",!1,100),l("estabelecimento_responsavel","Responsável pelo Estabelecimento","text",!1,255)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"10"}),"Assinaturas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-4 text-center",children:"AUTORIDADE FISCALIZADORA"}),e.jsx(A,{name:"assinatura_fiscal",label:"Assinatura do Fiscal",value:m.assinatura_fiscal,onChange:N,required:!0})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-4 text-center",children:"ESTABELECIMENTO FISCALIZADO"}),e.jsx(A,{name:"assinatura_responsavel",label:"Assinatura do Responsável",value:m.assinatura_responsavel,onChange:N,required:!0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"11"}),"Anexos"]}),e.jsxs("div",{className:"space-y-4",children:[i("possui_anexo","Possui anexo?"),o.possui_anexo&&e.jsxs(e.Fragment,{children:[n("descricao_anexo","Descrição dos Anexos",3),e.jsx(R,{onFilesChange:S,acceptedFormats:"image/*,.pdf,.doc,.docx",maxFiles:10,maxSize:10*1024*1024})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2",children:"12"}),"Observações"]}),n("observacoes","Observações gerais",4)]}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Erro ao salvar"}),e.jsx("div",{className:"text-sm text-red-700 mt-1",children:v})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200",children:[e.jsx(P,{to:"/fiscalizacao/infracoes",className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"← Voltar para Lista"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>window.history.back(),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 font-medium",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium flex items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Salvar Auto de Infração"]})})]})]}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"h-5 w-5 text-red-400 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Informações Importantes"}),e.jsxs("div",{className:"text-sm text-red-700 mt-1 space-y-1",children:[e.jsx("p",{children:"• O número do auto será gerado automaticamente pelo sistema."}),e.jsxs("p",{children:["• Campos marcados com ",e.jsx("span",{className:"text-red-500",children:"*"})," são obrigatórios."]}),e.jsx("p",{children:"• Marque todas as infrações encontradas durante a fiscalização."}),e.jsx("p",{children:"• O relatório deve ser detalhado e objetivo."}),e.jsx("p",{children:"• O valor da multa deve estar de acordo com a tabela vigente."}),e.jsx("p",{children:"• As assinaturas são obrigatórias para validar o documento."})]})]})]})})]})]})})})}export{V as default};
