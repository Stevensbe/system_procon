import{j as e}from"./main-BlGnCLHT.js";import{r as a}from"./router-C15yhWin.js";import{F as L}from"./XMarkIcon-C8R2LFm1.js";import{F as M}from"./ExclamationTriangleIcon-Y0luX6t1.js";import{F as q}from"./CheckCircleIcon-B-MrGrlS.js";function B({title:f,titleId:m,...c},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":m},c),f?a.createElement("title",{id:m},f):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const K=a.forwardRef(B);var U={};const H=({onScan:f,onClose:m,isOpen:c})=>{const[n,j]=a.useState(!1),[v,y]=a.useState(""),[l,d]=a.useState(""),[C,N]=a.useState(!1),[I,o]=a.useState(""),[A,E]=a.useState(null),[x,T]=a.useState(!1),i=a.useRef(null),P=a.useRef(null),h=a.useRef(null);a.useEffect(()=>(c&&!n?k():!c&&n&&_(),()=>{n&&_()}),[c]);const k=async()=>{j(!0),d(""),N(!1),y(""),o("Iniciando c√¢mera...");try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Navegador n√£o suporta acesso √† c√¢mera");const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});h.current=s,i.current.srcObject=s,await i.current.play(),o('C√¢mera ativa! Posicione o c√≥digo de barras e clique em "Capturar e Escanear".')}catch(s){console.error("Erro ao acessar c√¢mera:",s);let t=s.message;s.name==="NotAllowedError"?t="Permiss√£o de c√¢mera negada. Verifique as configura√ß√µes do navegador.":s.name==="NotFoundError"?t="Nenhuma c√¢mera encontrada no dispositivo.":s.name==="NotReadableError"&&(t="C√¢mera est√° sendo usada por outro aplicativo."),d(`Erro ao acessar c√¢mera: ${t}`),o(`Erro: ${s.name} - ${t}`),j(!1)}},_=()=>{h.current&&(h.current.getTracks().forEach(s=>s.stop()),h.current=null),i.current&&(i.current.srcObject=null),j(!1),E(null)},G=()=>{if(!i.current)return null;const s=P.current,t=i.current;return s.width=t.videoWidth,s.height=t.videoHeight,s.getContext("2d").drawImage(t,0,0),s.toDataURL("image/jpeg",.8)},O=async s=>{T(!0),o("Enviando imagem para Google Cloud Vision API...");try{const R={requests:[{image:{content:s.split(",")[1]},features:[{type:"TEXT_DETECTION",maxResults:5},{type:"DOCUMENT_TEXT_DETECTION",maxResults:1}]}]},S=U.REACT_APP_GOOGLE_VISION_API_KEY;if(!S)throw new Error("Google Vision API Key n√£o configurada. Configure REACT_APP_GOOGLE_VISION_API_KEY");const p=await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${S}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)});if(!p.ok)throw new Error(`Erro na API: ${p.status} ${p.statusText}`);const w=await p.json(),b=[];if(w.responses&&w.responses[0]){const r=w.responses[0];r.textAnnotations&&r.textAnnotations.length>0&&r.textAnnotations.forEach(g=>{const u=g.description;/^[0-9]{8,13}$/.test(u.replace(/\s/g,""))&&b.push({code:u.replace(/\s/g,""),confidence:.9,type:"TEXT_DETECTION"})}),r.fullTextAnnotation&&r.fullTextAnnotation.text&&r.fullTextAnnotation.text.split(`
`).forEach(F=>{const V=F.replace(/\s/g,"");/^[0-9]{8,13}$/.test(V)&&b.push({code:V,confidence:.95,type:"DOCUMENT_TEXT"})})}if(b.length>0){const r=b.reduce((g,u)=>u.confidence>g.confidence?u:g);y(r.code),N(!0),o(`C√≥digo detectado: ${r.code} (${r.type})`),setTimeout(()=>{f(r.code)},1e3)}else d("Nenhum c√≥digo de barras encontrado na imagem"),o("Tente posicionar melhor o c√≥digo de barras e capturar novamente")}catch(t){console.error("Erro na Google Vision API:",t),d(`Erro na an√°lise: ${t.message}`),o("Erro ao processar imagem. Verifique a configura√ß√£o da API.")}finally{T(!1)}},$=async()=>{if(!n||x)return;o("Capturando imagem...");const s=G();s?(E(s),await O(s)):d("Erro ao capturar imagem")},D=()=>{d(""),N(!1),y(""),E(null),o("Pronto para nova captura")};return c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"üì± Escanear C√≥digo de Barras (Google Vision)"}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",children:e.jsx(L,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"relative w-full h-64 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 overflow-hidden",children:l?e.jsxs("div",{className:"text-center p-4",children:[e.jsx(M,{className:"h-12 w-12 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-600 font-medium",children:l})]}):C?e.jsxs("div",{className:"text-center p-4",children:[e.jsx(q,{className:"h-12 w-12 text-green-500 mx-auto mb-2"}),e.jsx("p",{className:"text-green-600 font-medium",children:"C√≥digo detectado!"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:v})]}):n?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:i,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0}),A&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsx("img",{src:A,alt:"Capturado",className:"max-w-full max-h-full object-contain"})}),x&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),e.jsx("p",{children:"Processando..."})]})})]}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx(K,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Iniciando c√¢mera..."})]})})}),e.jsx("canvas",{ref:P,style:{display:"none"}}),e.jsx("div",{className:"mb-4 text-sm text-gray-600",children:e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Posicione o c√≥digo de barras na √°rea da c√¢mera"}),e.jsx("li",{children:'‚Ä¢ Clique em "Capturar e Escanear"'}),e.jsx("li",{children:"‚Ä¢ A imagem ser√° enviada para Google Cloud Vision API"}),e.jsx("li",{children:"‚Ä¢ Certifique-se de que h√° boa ilumina√ß√£o"})]})}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Status:"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${x?"bg-yellow-100 text-yellow-800":n?"bg-green-100 text-green-800":l?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:x?"Processando":n?"Ativo":l?"Erro":"Parado"})]}),v&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"C√≥digo: "}),e.jsx("span",{className:"text-sm font-mono bg-gray-200 px-2 py-1 rounded",children:v})]}),I&&e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Debug: "}),I]})]}),e.jsxs("div",{className:"flex space-x-3",children:[n&&!C&&!l&&!x&&e.jsx("button",{onClick:$,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"üì∏ Capturar e Escanear"}),l&&e.jsx("button",{onClick:D,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"üîÑ Tentar Novamente"}),e.jsx("button",{onClick:m,className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Fechar"})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"‚öôÔ∏è Google Cloud Vision API:"}),e.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[e.jsxs("p",{children:["‚Ä¢ Configure a vari√°vel de ambiente: ",e.jsx("code",{children:"REACT_APP_GOOGLE_VISION_API_KEY"})]}),e.jsx("p",{children:"‚Ä¢ Ative a Google Cloud Vision API no Google Cloud Console"}),e.jsx("p",{children:"‚Ä¢ Crie uma chave de API e configure as restri√ß√µes necess√°rias"})]})]})]})}):null};export{H as B,K as F};
