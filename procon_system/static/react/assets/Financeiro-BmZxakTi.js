import{j as e,F as k}from"./main-CRMJS0Wv.js";import{r as u}from"./router-Cgdj9vyr.js";import{R as K,B as te,C as oe,X as ne,Y as le,T as G,a as J,e as ce,P as ie,c as de,d as me}from"./charts-mbb-U41H.js";import{F as xe}from"./ExclamationTriangleIcon-2kHM3Vz3.js";import{F as ue}from"./XMarkIcon-D1YaT3yw.js";import"./vendor-Csw2ODfV.js";import"./icons-qiKTog5F.js";const E=({title:a,value:o,icon:r,color:g="blue",prefix:c="",suffix:m="",isLoading:i=!1})=>{const x={blue:"border-blue-500 bg-blue-50",green:"border-green-500 bg-green-50",yellow:"border-yellow-500 bg-yellow-50",red:"border-red-500 bg-red-50",purple:"border-purple-500 bg-purple-50"},t={blue:"text-blue-500",green:"text-green-500",yellow:"text-yellow-500",red:"text-red-500",purple:"text-purple-500"},n=d=>typeof d=="number"?c==="R$"?d.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):d.toLocaleString("pt-BR"):d;return e.jsx("div",{className:`bg-white rounded-lg shadow-md border-l-4 ${x[g]} p-6 hover:shadow-lg transition-shadow duration-200`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 uppercase tracking-wide mb-2",children:a}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i?e.jsx("div",{className:"animate-pulse bg-gray-200 h-8 w-24 rounded"}):e.jsxs(e.Fragment,{children:[c&&e.jsxs("span",{className:"text-lg",children:[c," "]}),n(o),m&&e.jsxs("span",{className:"text-lg",children:[" ",m]})]})})]}),r&&e.jsx("div",{className:`text-4xl ${t[g]} opacity-75`,children:e.jsx("i",{className:r})})]})})},ge=({dados:a=[],isLoading:o=!1,height:r=300})=>{const g=m=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(m),c=({active:m,payload:i,label:x})=>m&&i&&i.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:`Mês: ${x}`}),e.jsx("p",{className:"text-blue-600",children:`Arrecadação: ${g(i[0].value)}`})]}):null;return o?e.jsxs("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"animate-pulse bg-gray-200 h-6 w-48 rounded"})}),e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded"})]}):!a||a.length===0?e.jsx("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"fas fa-chart-bar text-4xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhum dado de arrecadação disponível"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Os dados aparecerão aqui quando houver multas pagas registradas no sistema."})]})}):e.jsxs("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-chart-bar text-blue-500 mr-2"}),"Arrecadação Mensal (Últimos 12 Meses)"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),e.jsx("span",{children:"Clique nas barras para mais detalhes"})]})]}),e.jsx(K,{width:"100%",height:r,children:e.jsxs(te,{data:a,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(oe,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(ne,{dataKey:"mes",stroke:"#666",fontSize:12,angle:-45,textAnchor:"end",height:80}),e.jsx(le,{stroke:"#666",fontSize:12,tickFormatter:g}),e.jsx(G,{content:e.jsx(c,{})}),e.jsx(J,{}),e.jsx(ce,{dataKey:"total",name:"Arrecadação (R$)",fill:"#3B82F6",radius:[4,4,0,0],cursor:"pointer"})]})}),e.jsx("div",{className:"mt-4 text-xs text-gray-500 text-center",children:"* Valores representam multas efetivamente pagas no período"})]})},pe=({dados:a=[],isLoading:o=!1,height:r=300})=>{const g={Pago:"#10B981",Pendente:"#F59E0B",Vencido:"#EF4444"},c=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),m=({active:t,payload:n})=>{if(t&&n&&n.length){const d=n[0].payload;return e.jsxs("div",{className:"bg-white p-4 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2",children:d.status}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Valor:"})," ",c(d.valor)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Percentual:"})," ",d.percentual.toFixed(1),"%"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Quantidade:"})," ",d.count," multas"]})]})}return null},i=({payload:t})=>e.jsx("div",{className:"flex flex-wrap justify-center gap-4 mt-4",children:t.map((n,d)=>{const p=a.find(N=>N.status===n.value);return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded mr-2",style:{backgroundColor:n.color}}),e.jsxs("span",{className:"text-sm text-gray-700",children:[n.value," (",p?p.percentual.toFixed(1):0,"%)"]})]},d)})});if(o)return e.jsxs("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"animate-pulse bg-gray-200 h-6 w-40 rounded"})}),e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded"})]});if(!a||a.length===0)return e.jsxs("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-chart-pie text-green-500 mr-2"}),"Composição da Carteira"]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"fas fa-chart-pie text-4xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhum dado disponível"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"A composição aparecerá quando houver multas cadastradas no sistema."})]})]});const x=a.filter(t=>t.valor>0);return x.length===0?e.jsxs("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-chart-pie text-green-500 mr-2"}),"Composição da Carteira"]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"fas fa-chart-pie text-4xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma multa com valor encontrada"})]})]}):e.jsxs("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-chart-pie text-green-500 mr-2"}),"Composição da Carteira"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),e.jsx("span",{children:"Por status das multas"})]})]}),e.jsx(K,{width:"100%",height:r,children:e.jsxs(ie,{children:[e.jsx(de,{data:x,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"valor",nameKey:"status",label:({status:t,percentual:n})=>`${n.toFixed(1)}%`,labelLine:!1,children:x.map((t,n)=>e.jsx(me,{fill:g[t.status]||"#8884d8"},`cell-${n}`))}),e.jsx(G,{content:e.jsx(m,{})}),e.jsx(J,{content:e.jsx(i,{})})]})}),e.jsx("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4",children:x.map((t,n)=>e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-4 h-4 rounded mx-auto mb-2",style:{backgroundColor:g[t.status]}}),e.jsx("p",{className:"font-medium text-gray-900",children:t.status}),e.jsx("p",{className:"text-sm text-gray-600",children:c(t.valor)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.count," multas"]})]},n))})]})},he=({dados:a=[],empresas:o=[],isLoading:r=!1,onFilter:g,filtros:c={},totalRegistros:m=0,paginacao:i={},onPageChange:x,onExportar:t})=>{const[n,d]=u.useState({data_inicio:"",data_fim:"",status:"",empresa:"",search:"",...c}),p=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),N=s=>new Date(s).toLocaleDateString("pt-BR"),b=(s,h)=>{const f={...n,[s]:h};d(f)},w=()=>{g(n)},R=()=>{const s={data_inicio:"",data_fim:"",status:"",empresa:"",search:""};d(s),g(s)},P=s=>{const h={paga:"bg-green-100 text-green-800",pendente:"bg-yellow-100 text-yellow-800",vencida:"bg-red-100 text-red-800"},f={paga:"Paga",pendente:"Pendente",vencida:"Vencida"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${h[s]||"bg-gray-100 text-gray-800"}`,children:f[s]||s})};return r?e.jsx("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48 mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,h)=>e.jsx("div",{className:"h-4 bg-gray-200 rounded"},h))})]})}):e.jsxs("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-table text-purple-500 mr-2"}),"Relatório Detalhado de Multas"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:t,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("i",{className:"fas fa-download mr-2"}),"Exportar CSV"]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Início"}),e.jsx("input",{type:"date",value:n.data_inicio,onChange:s=>b("data_inicio",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:n.data_fim,onChange:s=>b("data_fim",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:n.status,onChange:s=>b("status",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"paga",children:"Paga"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"vencida",children:"Vencida"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Empresa"}),e.jsxs("select",{value:n.empresa,onChange:s=>b("empresa",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"Todas as empresas"}),o.map(s=>e.jsx("option",{value:s.id,children:s.razao_social},s.id))]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar (empresa, CNPJ ou nº processo)"}),e.jsx("input",{type:"text",placeholder:"Digite para buscar...",value:n.search,onChange:s=>b("search",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsxs("button",{onClick:w,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Filtrar"]}),e.jsxs("button",{onClick:R,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Limpar"]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empresa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Emissão"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Vencimento"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Processo"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"px-6 py-12 text-center",children:[e.jsx("i",{className:"fas fa-search text-4xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma multa encontrada"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Tente ajustar os filtros de busca ou verificar se há dados cadastrados."})]})}):Array.isArray(a)?a.map(s=>{var h,f,A;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",s.id]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(h=s.empresa)==null?void 0:h.razao_social}),e.jsx("div",{className:"text-sm text-gray-500",children:(f=s.empresa)==null?void 0:f.cnpj})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:p(s.valor)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(s.data_emissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(s.data_vencimento)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:P(s.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((A=s.processo)==null?void 0:A.numero)||"-"})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-8 text-center",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-3xl mb-2"}),e.jsx("p",{children:"Erro ao carregar dados. Dados inválidos recebidos."})]})})})})]})}),Array.isArray(a)&&a.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",a.length," de ",m," registros"]}),i&&(i.previous||i.next)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>x("previous"),disabled:!i.previous,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("i",{className:"fas fa-chevron-left mr-2"}),"Anterior"]}),e.jsxs("button",{onClick:()=>x("next"),disabled:!i.next,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:["Próximo",e.jsx("i",{className:"fas fa-chevron-right ml-2"})]})]})]})]})},fe=({show:a,onDismiss:o})=>a?e.jsx("div",{className:"fixed top-4 right-4 max-w-md bg-orange-50 border border-orange-200 rounded-lg shadow-lg p-4 z-50",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(xe,{className:"h-5 w-5 text-orange-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"Modo Demonstração"}),e.jsx("div",{className:"mt-2 text-sm text-orange-700",children:e.jsx("p",{children:"O sistema está exibindo dados simulados porque o backend não está disponível. Os gráficos e números são apenas para demonstração."})})]}),e.jsx("div",{className:"ml-auto pl-3",children:e.jsx("div",{className:"-mx-1.5 -my-1.5",children:e.jsx("button",{onClick:o,className:"inline-flex rounded-md bg-orange-50 p-1.5 text-orange-500 hover:bg-orange-100 focus:outline-none focus:ring-2 focus:ring-orange-600 focus:ring-offset-2 focus:ring-offset-orange-50",children:e.jsx(ue,{className:"h-5 w-5"})})})})]})}):null;let I=!1,M=null;const be=3e4,C=async()=>{const a=Date.now();return M&&a-M<be?I:(console.info("🔄 Modo demo ativado - usando dados simulados"),I=!1,M=a,!1)},q={totalArrecadado:125840.5,multasEmAberto:34,empresasAdimplentes:156,ticketMedio:1850.75,crescimentoMensal:12.5,statusCarteira:"saudavel"},O=[{mes:"Jan",valor:45800,multas:12},{mes:"Fev",valor:52300,multas:15},{mes:"Mar",valor:48900,multas:18},{mes:"Abr",valor:61200,multas:22},{mes:"Mai",valor:55600,multas:19},{mes:"Jun",valor:68400,multas:25}],z=[{categoria:"Multas Pagas",valor:85600,percentual:68},{categoria:"Em Aberto",valor:25200,percentual:20},{categoria:"Em Negociação",valor:15e3,percentual:12}],L=[{tipo:"Publicidade Enganosa",quantidade:45,valor:67500},{tipo:"Práticas Abusivas",quantidade:32,valor:48e3},{tipo:"Produto Defeituoso",quantidade:28,valor:42e3},{tipo:"Preço Abusivo",quantidade:19,valor:28500}],U=[{id:1,nome:"Supermercado ABC Ltda",status:"adimplente",ultimoPagamento:"2024-01-15"},{id:2,nome:"Loja XYZ S/A",status:"pendente",ultimoPagamento:"2023-12-10"},{id:3,nome:"Farmácia Central",status:"adimplente",ultimoPagamento:"2024-01-20"}];class je{async getDashboardData(){if(!await C())return console.info("🔄 Backend offline, usando dados de demonstração"),{...q,_mockData:!0};try{return{...(await k.get("financeiro/dashboard/")).data,_mockData:!1}}catch(r){return console.warn("⚠️ Erro na API, fallback para dados mock:",r.message),{...q,_mockData:!0}}}async getArrecadacaoMensal(){if(!await C())return console.info("🔄 Backend offline, usando dados de demonstração (arrecadação)"),O;try{return(await k.get("financeiro/arrecadacao-mensal/")).data}catch(r){return console.warn("⚠️ Erro na API, fallback para dados mock:",r.message),O}}async getComposicaoCarteira(){if(!await C())return console.info("🔄 Backend offline, usando dados de demonstração (carteira)"),z;try{return(await k.get("financeiro/composicao-carteira/")).data}catch(r){return console.warn("⚠️ Erro na API, fallback para dados mock:",r.message),z}}async getRelatorioMultas(o={},r=1){if(!await C())return console.info("🔄 Backend offline, usando dados de demonstração (relatórios)"),{results:L,count:L.length,next:null,previous:null};try{const c=new URLSearchParams;Object.keys(o).forEach(t=>{o[t]&&o[t]!==""&&c.append(t,o[t])}),r>1&&c.append("page",r);const m=c.toString(),i=`financeiro/relatorios/${m?`?${m}`:""}`;return(await k.get(i)).data}catch(c){return console.warn("⚠️ Erro na API, fallback para dados mock:",c.message),{results:L,count:L.length,next:null,previous:null}}}async getEmpresas(){if(!await C())return console.info("🔄 Backend offline, usando dados de demonstração (empresas)"),U;try{return(await k.get("financeiro/empresas/")).data}catch(r){return console.warn("⚠️ Erro na API, fallback para dados mock:",r.message),U}}async exportarCSV(o={}){try{const r=new URLSearchParams;Object.keys(o).forEach(p=>{o[p]&&o[p]!==""&&r.append(p,o[p])});const g=r.toString(),c=`financeiro/exportar/${g?`?${g}`:""}`,m=await k.get(c,{responseType:"blob"}),i=new Blob([m.data],{type:"text/csv"}),x=window.URL.createObjectURL(i),t=document.createElement("a");t.href=x;const n=m.headers["content-disposition"];let d="relatorio_financeiro.csv";if(n){const p=n.match(/filename="?(.+)"?/);p&&(d=p[1])}return t.download=d,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(x),{success:!0,message:"Arquivo exportado com sucesso!"}}catch(r){throw console.error("Erro ao exportar dados:",r),r}}formatCurrency(o){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o)}formatDate(o){return new Date(o).toLocaleDateString("pt-BR")}calculatePercentage(o,r){return r===0?0:o/r*100}}const v=new je;function Se(){const[a,o]=u.useState(null),[r,g]=u.useState([]),[c,m]=u.useState([]),[i,x]=u.useState([]),[t,n]=u.useState([]),[d,p]=u.useState(!1),[N,b]=u.useState(!1),[w,R]=u.useState(!0),[P,s]=u.useState(!0),[h,f]=u.useState(!0),[A,_]=u.useState(!0),[ye,T]=u.useState(!0),[D,X]=u.useState({}),[S,$]=u.useState(1),[V,Y]=u.useState(0),[F,H]=u.useState({}),Q=async()=>{try{R(!0);const l=await v.getDashboardData();o(l),l._mockData&&(p(!0),b(!0))}catch(l){console.error("Erro ao carregar dashboard:",l),p(!0)}finally{R(!1)}},Z=async()=>{try{s(!0);const l=await v.getArrecadacaoMensal();g(l.dados||[])}catch(l){console.error("Erro ao carregar arrecadação mensal:",l)}finally{s(!1)}},W=async()=>{try{f(!0);const l=await v.getComposicaoCarteira();m(l.dados||[])}catch(l){console.error("Erro ao carregar composição da carteira:",l)}finally{f(!1)}},B=async(l={},j=1)=>{try{_(!0);const y=await v.getRelatorioMultas(l,j);console.log("Resposta da API relatório:",y),x(y.results||[]),Y(y.count||0),H({next:y.next,previous:y.previous})}catch(y){console.error("Erro ao carregar relatório:",y),x([])}finally{_(!1)}},ee=async()=>{try{T(!0);const l=await v.getEmpresas();n(l.empresas||[])}catch(l){console.error("Erro ao carregar empresas:",l)}finally{T(!1)}},ae=l=>{X(l),$(1),B(l,1)},se=l=>{let j=S;l==="next"&&F.next?j=S+1:l==="previous"&&F.previous&&(j=S-1),j!==S&&($(j),B(D,j))},re=async()=>{try{await v.exportarCSV(D)}catch(l){console.error("Erro ao exportar dados:",l),alert("Erro ao exportar dados. Tente novamente.")}};return u.useEffect(()=>{Q(),Z(),W(),ee(),B()},[]),e.jsxs(e.Fragment,{children:[e.jsx(fe,{show:N,onDismiss:()=>b(!1)}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-[#0c0f12] p-6 transition-colors duration-300",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center transition-colors duration-300",children:[e.jsx("i",{className:"fas fa-chart-line text-blue-600 dark:text-blue-400 mr-3"}),"Dashboard Financeiro"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2 transition-colors duration-300",children:"Análise e visualização dos dados financeiros do sistema PROCON"})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300",children:[e.jsx("i",{className:"fas fa-sync-alt mr-1"}),d?e.jsx("span",{className:"text-orange-500 dark:text-orange-400 bg-orange-100 dark:bg-orange-900/30 px-2 py-1 rounded transition-colors duration-300",children:"Modo Demo - Dados simulados"}):"Atualizado em tempo real"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(E,{title:"Arrecadação no Mês",value:(a==null?void 0:a.arrecadacao_mes)||0,prefix:"R$",icon:"fas fa-calendar-check",color:"blue",isLoading:w}),e.jsx(E,{title:"Total a Receber",value:(a==null?void 0:a.total_pendente)||0,prefix:"R$",icon:"fas fa-coins",color:"green",isLoading:w}),e.jsx(E,{title:"Total em Atraso",value:(a==null?void 0:a.total_atraso)||0,prefix:"R$",icon:"fas fa-exclamation-triangle",color:"red",isLoading:w}),e.jsx(E,{title:"Taxa de Conversão",value:(a==null?void 0:a.taxa_conversao)||0,suffix:"%",icon:"fas fa-percentage",color:"purple",isLoading:w})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ge,{dados:r,isLoading:P,height:350})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(pe,{dados:c,isLoading:h,height:350})})]}),e.jsx("div",{className:"mb-8",children:e.jsx(he,{dados:i,empresas:t,isLoading:A,onFilter:ae,filtros:D,totalRegistros:V,paginacao:F,onPageChange:se,onExportar:re})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Empresas Cadastradas"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:V}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Multas"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:v.formatCurrency(((a==null?void 0:a.arrecadacao_mes)||0)+((a==null?void 0:a.total_pendente)||0))}),e.jsx("div",{className:"text-sm text-gray-600",children:"Valor Total da Carteira"})]})]})})]})]})}export{Se as default};
