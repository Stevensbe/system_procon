import{E as p,j as e}from"./main-QkSqPps8.js";import{u as B,e as z,r as d}from"./router-C15yhWin.js";import{n as i}from"./index-CsOmCsbp.js";import{F as L,B as O}from"./BarcodeScannerGoogleVision-BAp5gTQI.js";import{p as w}from"./produtosService-BvIIrZNF.js";import"./vendor-Csw2ODfV.js";import"./icons-C8WIGuh4.js";import"./XMarkIcon-C8R2LFm1.js";import"./ExclamationTriangleIcon-Y0luX6t1.js";import"./CheckCircleIcon-B-MrGrlS.js";const J=()=>{const x=B(),{id:c}=z(),[b,f]=d.useState(!1),[j,k]=d.useState([]),[A,S]=d.useState(""),[o,u]=d.useState({tipo_documento:"apreensao",numero_documento:"",ano_documento:new Date().getFullYear(),auto_constatacao:null,razao_social:"",nome_fantasia:"",atividade:"",endereco:"",cep:"",municipio:"",estado:"AM",cnpj:"",telefone:"",cominacao_legal:"",auto_constatacao_numero:"",itens:[],necessita_pericia:!1,justificativa_pericia:"",local:"",data_fiscalizacao:"",hora_inicio:"",hora_termino:"",fiscal_1:"",fiscal_2:"",responsavel_estabelecimento:"",cpf_responsavel:""}),[l,h]=d.useState({item:"",quantidade:1,unidade:"",especificacao:"",valor_unitario:0,motivo_apreensao:""}),[C,y]=d.useState(!1),[N,_]=d.useState(!1);d.useEffect(()=>{c?P():(E(),I())},[c]);const P=async()=>{try{if(f(!0),c==="novo")u({tipo_documento:"apreensao",numero_documento:"",ano_documento:new Date().getFullYear(),auto_constatacao:null,razao_social:"",nome_fantasia:"",atividade:"",endereco:"",cep:"",municipio:"",estado:"AM",cnpj:"",telefone:"",cominacao_legal:"",auto_constatacao_numero:"",itens:[],necessita_pericia:!1,justificativa_pericia:"",local:"",data_fiscalizacao:new Date().toISOString().split("T")[0],hora_inicio:"",hora_termino:"",fiscal_1:"",fiscal_2:"",responsavel_estabelecimento:"",cpf_responsavel:""});else{const a=await p.get(`/api/fiscalizacao/apreensao-inutilizacao/${c}/`);u(a.data)}}catch{i.error("Erro ao carregar auto de apreens√£o")}finally{f(!1)}},E=async()=>{try{const a=await p.get("/api/fiscalizacao/apreensao-inutilizacao/autos_supermercado_disponiveis/");k(a.data)}catch(a){console.error("Erro ao carregar autos de supermercado:",a)}},I=async()=>{try{const a=await p.get("/api/fiscalizacao/apreensao-inutilizacao/proximo_numero/");S(a.data.proximo_numero)}catch(a){console.error("Erro ao carregar pr√≥ximo n√∫mero:",a)}},r=a=>{const{name:s,value:n,type:t,checked:g}=a.target;u(v=>({...v,[s]:t==="checkbox"?g:n||""}))},m=a=>{const{name:s,value:n}=a.target;h(t=>({...t,[s]:n||""}))},D=a=>{u(s=>({...s,auto_constatacao:a.id,razao_social:a.razao_social||"",nome_fantasia:a.nome_fantasia||"",atividade:a.atividade||"",endereco:a.endereco||"",cep:a.cep||"",municipio:a.municipio||"",estado:a.estado||"AM",cnpj:a.cnpj||"",telefone:a.telefone||"",auto_constatacao_numero:a.numero||"",data_fiscalizacao:a.data_fiscalizacao||"",hora_inicio:a.hora_fiscalizacao||"",fiscal_1:a.fiscal_nome_1||"",fiscal_2:a.fiscal_nome_2||"",responsavel_estabelecimento:a.responsavel_nome||"",cpf_responsavel:a.responsavel_cpf||""})),i.success(`Auto de Constata√ß√£o ${a.numero} selecionado!`)},F=()=>{if(!l.item||!l.especificacao){i.error("Preencha os campos obrigat√≥rios do item");return}u(a=>({...a,itens:[...a.itens,{...l,id:Date.now()}]})),h({item:"",quantidade:1,unidade:"",especificacao:"",valor_unitario:0,motivo_apreensao:""})},q=a=>{u(s=>({...s,itens:s.itens.filter((n,t)=>t!==a)}))},R=async a=>{try{_(!0),y(!1);const s=await w.buscarPorCodigoBarras(a);if(s.success&&s.produto){const n=s.produto;h(g=>({...g,item:n.nome||`Produto ${a}`,especificacao:n.especificacao||"Produto escaneado - especifica√ß√µes devem ser preenchidas manualmente",valor_unitario:n.preco_referencia?parseFloat(n.preco_referencia):0,unidade:n.unidade_medida||"un"}));let t=`Produto escaneado: ${n.nome}`;if(s.source==="internal"?t+=" (Dados do sistema interno)":s.source==="external"?t+=" (Dados de API externa)":s.source==="generic"&&(t+=" (Produto gen√©rico - preencha especifica√ß√µes)"),i.success(t),(s.source==="external"||s.source==="generic")&&window.confirm("Produto encontrado em fonte externa. Deseja salvar no banco interno para futuras consultas?"))try{await w.criarProdutoAPIScanner({nome:n.nome,codigo_barras:n.codigo_barras,especificacao:n.especificacao,unidade_medida:n.unidade_medida,preco_referencia:n.preco_referencia,classificacao_risco:n.classificacao_risco,controlado_anvisa:n.controlado_anvisa,tem_validade:n.tem_validade,condicoes_armazenamento:n.condicoes_armazenamento}),i.success("Produto salvo no banco interno!")}catch(v){console.error("Erro ao salvar produto:",v),i.error("Erro ao salvar produto no banco interno")}}else i.error("Produto n√£o encontrado")}catch(s){console.error("Erro ao processar c√≥digo de barras:",s),i.error("Erro ao buscar informa√ß√µes do produto")}finally{_(!1)}},$=()=>{y(!1)},M=async a=>{if(a.preventDefault(),!o.razao_social||!o.nome_fantasia||!o.endereco){i.error("Preencha os campos obrigat√≥rios");return}try{f(!0),c?(await p.put(`/api/fiscalizacao/apreensao-inutilizacao/${c}/`,o),i.success("Auto de apreens√£o atualizado com sucesso")):(await p.post("/api/fiscalizacao/apreensao-inutilizacao/",o),i.success("Auto de apreens√£o criado com sucesso")),x("/fiscalizacao/apreensao-inutilizacao")}catch{i.error("Erro ao salvar auto de apreens√£o")}finally{f(!1)}};return b?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:[c?"Editar":"Novo"," Auto de Apreens√£o/Inutiliza√ß√£o"]}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo do Documento"}),e.jsxs("select",{name:"tipo_documento",value:o.tipo_documento,onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"apreensao",children:"Auto de Apreens√£o"}),e.jsx("option",{value:"inutilizacao",children:"Inutiliza√ß√£o"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero do Documento"}),e.jsx("input",{type:"text",name:"numero_documento",value:A||o.numero_documento||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Gerado automaticamente"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"N√∫mero gerado automaticamente"})]})]}),!c&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"üìã Selecionar Auto de Constata√ß√£o de Supermercado"}),j.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Selecione o Auto de Constata√ß√£o para preencher automaticamente os dados:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:j.map(a=>e.jsxs("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${o.auto_constatacao===a.id?"border-blue-500 bg-blue-100":"border-gray-200 bg-white hover:border-blue-300"}`,onClick:()=>D(a),children:[e.jsx("div",{className:"font-medium text-sm text-gray-800",children:a.numero}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:a.razao_social}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(a.data_fiscalizacao).toLocaleDateString()})]},a.id))})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-blue-700",children:"Nenhum Auto de Constata√ß√£o de Supermercado dispon√≠vel."}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Crie primeiro um Auto de Constata√ß√£o de Supermercado."})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Dados do Estabelecimento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Raz√£o Social *"}),e.jsx("input",{type:"text",name:"razao_social",value:o.razao_social||"",onChange:r,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Fantasia *"}),e.jsx("input",{type:"text",name:"nome_fantasia",value:o.nome_fantasia||"",onChange:r,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Atividade"}),e.jsx("input",{type:"text",name:"atividade",value:o.atividade||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CNPJ"}),e.jsx("input",{type:"text",name:"cnpj",value:o.cnpj||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"00.000.000/0000-00"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Endere√ßo *"}),e.jsx("input",{type:"text",name:"endereco",value:o.endereco||"",onChange:r,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CEP"}),e.jsx("input",{type:"text",name:"cep",value:o.cep||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"00000-000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Munic√≠pio"}),e.jsx("input",{type:"text",name:"municipio",value:o.municipio||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comina√ß√£o Legal"}),e.jsx("textarea",{name:"cominacao_legal",value:o.cominacao_legal||"",onChange:r,rows:"4",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Base legal para a apreens√£o/inutiliza√ß√£o..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Auto de Constata√ß√£o N¬∫"}),e.jsx("input",{type:"text",name:"auto_constatacao_numero",value:o.auto_constatacao_numero||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"N√∫mero do auto de constata√ß√£o"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Itens Apreendidos/Inutilizados"}),o.itens.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Itens adicionados:"}),e.jsx("div",{className:"space-y-2",children:o.itens.map((a,s)=>e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded border",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:a.item}),e.jsxs("span",{className:"text-gray-600 ml-2",children:["- ",a.quantidade," ",a.unidade]})]}),e.jsx("button",{type:"button",onClick:()=>q(s),className:"text-red-600 hover:text-red-800",children:"Remover"})]},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item *"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",name:"item",value:l.item||"",onChange:m,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nome do item"}),e.jsx("button",{type:"button",onClick:()=>y(!0),disabled:N,className:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50",title:"Escanear c√≥digo de barras",children:e.jsx(L,{className:"h-4 w-4"})})]}),N&&e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Buscando informa√ß√µes do produto..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade"}),e.jsx("input",{type:"number",name:"quantidade",value:l.quantidade||1,onChange:m,min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Unidade"}),e.jsx("input",{type:"text",name:"unidade",value:l.unidade||"",onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"un, kg, l, etc."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Especifica√ß√£o *"}),e.jsx("input",{type:"text",name:"especificacao",value:l.especificacao||"",onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Descri√ß√£o detalhada do item"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Unit√°rio (R$)"}),e.jsx("input",{type:"number",name:"valor_unitario",value:l.valor_unitario||0,onChange:m,step:"0.01",min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo da Apreens√£o/Inutiliza√ß√£o"}),e.jsx("textarea",{name:"motivo_apreensao",value:l.motivo_apreensao||"",onChange:m,rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Motivo da apreens√£o ou inutiliza√ß√£o..."})]})]}),e.jsx("button",{type:"button",onClick:F,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Adicionar Item"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Per√≠cia"}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",name:"necessita_pericia",checked:o.necessita_pericia,onChange:r,className:"mr-2"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Os itens apreendidos/inutilizados necessitam de per√≠cia?"})]}),o.necessita_pericia&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Justificativa da Per√≠cia"}),e.jsx("textarea",{name:"justificativa_pericia",value:o.justificativa_pericia||"",onChange:r,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Justificativa para a necessidade de per√≠cia..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Local"}),e.jsx("input",{type:"text",name:"local",value:o.local||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data da Fiscaliza√ß√£o"}),e.jsx("input",{type:"date",name:"data_fiscalizacao",value:o.data_fiscalizacao||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hora do In√≠cio"}),e.jsx("input",{type:"time",name:"hora_inicio",value:o.hora_inicio||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hora do T√©rmino"}),e.jsx("input",{type:"time",name:"hora_termino",value:o.hora_termino||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Assinaturas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fiscal 1"}),e.jsx("input",{type:"text",name:"fiscal_1",value:o.fiscal_1||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fiscal 2"}),e.jsx("input",{type:"text",name:"fiscal_2",value:o.fiscal_2||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome do Respons√°vel"}),e.jsx("input",{type:"text",name:"responsavel_estabelecimento",value:o.responsavel_estabelecimento||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF do Respons√°vel"}),e.jsx("input",{type:"text",name:"cpf_responsavel",value:o.cpf_responsavel||"",onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"000.000.000-00"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>x("/fiscalizacao/apreensao-inutilizacao"),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:b?"Salvando...":c?"Atualizar":"Salvar"})]})]}),e.jsx(O,{isOpen:C,onScan:R,onClose:$})]})},Z=()=>{const{id:x}=z();return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[x?"Editar":"Novo"," Auto de Apreens√£o/Inutiliza√ß√£o"]}),e.jsxs("p",{className:"mt-2 text-gray-600",children:["Formul√°rio para cria√ß√£o de autos de apreens√£o ou inutiliza√ß√£o de produtos.",e.jsx("br",{}),e.jsx("span",{className:"text-blue-600 font-medium",children:"üì± Funcionalidade de escaneamento de c√≥digo de barras dispon√≠vel!"})]})]}),e.jsx(J,{})]})})};export{Z as default};
