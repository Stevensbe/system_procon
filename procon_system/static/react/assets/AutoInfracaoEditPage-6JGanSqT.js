import{A as O,j as e,D as T}from"./main-DVdFXPbZ.js";import{e as M,u as $,r as c,L as B}from"./router-C15yhWin.js";import{S as E,F as V}from"./FileUpload-CIYprfM2.js";import"./vendor-Csw2ODfV.js";import"./icons-C8WIGuh4.js";function q(){const{id:m}=M(),j=$(),[z,N]=c.useState(!0),[_,p]=c.useState(!1),[y,g]=c.useState(""),[i,b]=c.useState({data_fiscalizacao:"",hora_fiscalizacao:"",municipio:"",estado:"",razao_social:"",nome_fantasia:"",atividade:"",endereco:"",cnpj:"",telefone:"",parecer_numero:"",parecer_origem:"",relatorio:"",base_legal_cdc:"",base_legal_outras:"",infracao_art_34:!1,infracao_art_35:!1,infracao_art_36:!1,infracao_art_55:!1,infracao_art_56:!1,infracao_publicidade_enganosa:!1,infracao_precos_abusivos:!1,infracao_produtos_vencidos:!1,infracao_falta_informacao:!1,outras_infracoes:"",fundamentacao_tecnica:"",fundamentacao_juridica:"",valor_multa:"",responsavel_nome:"",responsavel_cpf:"",responsavel_funcao:"",fiscal_nome:"",fiscal_cargo:"",estabelecimento_responsavel:"",data_notificacao:"",data_vencimento:"",status:"",possui_anexo:!1,descricao_anexo:"",observacoes:""}),[x,C]=c.useState({assinatura_fiscal:"",assinatura_responsavel:""}),[v,S]=c.useState([]);c.useEffect(()=>{k()},[m]);const k=async()=>{try{N(!0);const a=await O(m),r={...a,data_fiscalizacao:a.data_fiscalizacao?a.data_fiscalizacao.split("T")[0]:"",data_notificacao:a.data_notificacao?a.data_notificacao.split("T")[0]:"",data_vencimento:a.data_vencimento?a.data_vencimento.split("T")[0]:""};b(r),C({assinatura_fiscal:a.assinatura_fiscal||"",assinatura_responsavel:a.assinatura_responsavel||""})}catch(a){console.error("❌ Erro ao carregar auto:",a),g("Erro ao carregar auto de infração")}finally{N(!1)}},f=a=>{const{name:r,value:o,type:s,checked:t}=a.target;b(s==="checkbox"?u=>({...u,[r]:t}):u=>({...u,[r]:o}))},A=(a,r)=>{C(o=>({...o,[a]:r}))},D=a=>{S(a)},P=(a,r)=>{var o;try{if(!a||typeof a!="string"||!a.includes("data:image/"))return null;const s=a.split(",");if(s.length!==2)throw new Error("Formato base64 inválido");const t=(o=s[0].match(/:(.*?);/))==null?void 0:o[1];if(!t)throw new Error("MIME type não encontrado");const u=atob(s[1]),F=u.length,w=new Uint8Array(F);for(let h=0;h<F;h++)w[h]=u.charCodeAt(h);return new File([w],r,{type:t})}catch(s){return console.error(`Erro ao converter assinatura ${r}:`,s),null}},I=async a=>{if(a.preventDefault(),p(!0),g(""),!i.razao_social||!i.cnpj||!i.relatorio||!i.valor_multa){g("Preencha todos os campos obrigatórios"),p(!1);return}try{const r=new FormData;Object.keys(i).forEach(s=>{const t=i[s];typeof t=="boolean"?r.append(s,t?"true":"false"):t!=null&&t!==""&&r.append(s,String(t))}),Object.keys(x).forEach(s=>{if(x[s]&&x[s].startsWith("data:image/")){const t=P(x[s],`${s}.png`);t&&r.append(s,t)}}),v&&v.length>0&&v.forEach((s,t)=>{s&&s.file instanceof File&&(r.append("anexos",s.file),r.append(`anexo_descricao_${t}`,s.name||s.file.name))});const o=await T(m,r);alert(`Auto de Infração "${o.numero}" atualizado com sucesso!`),j(`/fiscalizacao/infracoes/${m}`,{replace:!0})}catch(r){console.error("Erro ao salvar:",r),g(r.message||"Ocorreu um erro ao atualizar o auto de infração.")}finally{p(!1)}},l=(a,r,o="text",s=!1,t=null)=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:a,className:"block text-sm font-medium text-gray-700",children:[r," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:o,id:a,name:a,value:i[a]||"",onChange:f,required:s,maxLength:t,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500"})]}),n=(a,r,o=3,s=!1)=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:a,className:"block text-sm font-medium text-gray-700",children:[r," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:a,name:a,value:i[a]||"",onChange:f,required:s,rows:o,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500"})]}),d=(a,r,o="")=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("input",{type:"checkbox",id:a,name:a,checked:i[a]||!1,onChange:f,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded mt-1"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("label",{htmlFor:a,className:"block text-sm text-gray-700",children:r}),o&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:o})]})]}),R=(a,r,o,s=!1)=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:a,className:"block text-sm font-medium text-gray-700",children:[r," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:a,name:a,value:i[a]||"",onChange:f,required:s,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),o.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),L=[{value:"autuado",label:"Autuado"},{value:"notificado",label:"Notificado"},{value:"em_defesa",label:"Em Defesa"},{value:"julgado",label:"Julgado"},{value:"pago",label:"Pago"},{value:"cancelado",label:"Cancelado"}];return z?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando auto de infração..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-blue-600 px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Editar Auto de Infração"}),e.jsxs("p",{className:"text-blue-100 mt-1",children:["Número: ",e.jsx("span",{className:"font-mono bg-blue-700 px-2 py-1 rounded text-sm",children:i.numero})]})]}),e.jsxs("form",{onSubmit:I,className:"p-6 space-y-8",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"1"}),"Dados Básicos"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[l("data_fiscalizacao","Data da Fiscalização","date",!0),l("hora_fiscalizacao","Hora da Fiscalização","time",!0),l("municipio","Município","text",!0),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),e.jsx("input",{type:"text",value:i.estado||"AMAZONAS",disabled:!0,className:"mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md text-gray-500"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"2"}),"Dados do Estabelecimento"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[l("razao_social","Razão Social","text",!0,255),l("nome_fantasia","Nome Fantasia","text",!1,255),l("atividade","Atividade","text",!0,255),l("endereco","Endereço","text",!0,500),l("cnpj","CNPJ","text",!0,18),l("telefone","Telefone","tel",!1,20)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"3"}),"Parecer Prévio"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l("parecer_numero","Número do Parecer","text",!1,50),l("parecer_origem","Origem do Parecer","text",!1,100)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"4"}),"Relatório"]}),n("relatorio","Relatório Detalhado",8,!0)]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"5"}),"Base Legal"]}),e.jsxs("div",{className:"space-y-4",children:[n("base_legal_cdc","Artigos do CDC violados",4,!0),n("base_legal_outras","Outras bases legais",4)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"6"}),"Infrações Constatadas"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Artigos do CDC"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d("infracao_art_34","Art. 34 CDC","Informação adequada e clara"),d("infracao_art_35","Art. 35 CDC","Publicidade enganosa"),d("infracao_art_36","Art. 36 CDC","Publicidade abusiva"),d("infracao_art_55","Art. 55 CDC","Oferta inadequada"),d("infracao_art_56","Art. 56 CDC","Recusa de venda")]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Outras Infrações"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d("infracao_publicidade_enganosa","Publicidade Enganosa"),d("infracao_precos_abusivos","Preços Abusivos"),d("infracao_produtos_vencidos","Produtos Vencidos"),d("infracao_falta_informacao","Falta de Informação")]})]}),n("outras_infracoes","Outras infrações específicas",4)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"7"}),"Fundamentação"]}),e.jsxs("div",{className:"space-y-4",children:[n("fundamentacao_tecnica","Fundamentação Técnica",4),n("fundamentacao_juridica","Fundamentação Jurídica",4)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"8"}),"Penalidade"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l("valor_multa","Valor da Multa (R$)","number",!0),R("status","Status",L,!0),l("data_notificacao","Data de Notificação","date"),l("data_vencimento","Data de Vencimento","date")]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"9"}),"Responsáveis"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Autoridade Fiscalizadora"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l("fiscal_nome","Nome do Fiscal","text",!0,255),l("fiscal_cargo","Cargo do Fiscal","text",!0,100)]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Estabelecimento Fiscalizado"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[l("responsavel_nome","Nome do Responsável","text",!0,255),l("responsavel_cpf","CPF do Responsável","text",!0,14),l("responsavel_funcao","Função/Cargo","text",!1,100),l("estabelecimento_responsavel","Responsável pelo Estabelecimento","text",!1,255)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"10"}),"Assinaturas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-4 text-center",children:"AUTORIDADE FISCALIZADORA"}),e.jsx(E,{name:"assinatura_fiscal",label:"Assinatura do Fiscal",value:x.assinatura_fiscal,onChange:A,required:!0})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-4 text-center",children:"ESTABELECIMENTO FISCALIZADO"}),e.jsx(E,{name:"assinatura_responsavel",label:"Assinatura do Responsável",value:x.assinatura_responsavel,onChange:A,required:!0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"11"}),"Anexos"]}),e.jsxs("div",{className:"space-y-4",children:[d("possui_anexo","Possui anexo?"),i.possui_anexo&&e.jsxs(e.Fragment,{children:[n("descricao_anexo","Descrição dos Anexos",3),e.jsx(V,{onFilesChange:D,acceptedFormats:"image/*,.pdf,.doc,.docx",maxFiles:10,maxSize:10*1024*1024})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm mr-2",children:"12"}),"Observações"]}),n("observacoes","Observações gerais",4)]}),y&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Erro ao salvar"}),e.jsx("div",{className:"text-sm text-red-700 mt-1",children:y})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200",children:[e.jsx(B,{to:`/fiscalizacao/infracoes/${m}`,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"← Voltar para Detalhes"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>j(`/fiscalizacao/infracoes/${m}`),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 font-medium",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:_,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium flex items-center",children:_?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Salvar Alterações"]})})]})]})]})]})})})}export{q as default};
