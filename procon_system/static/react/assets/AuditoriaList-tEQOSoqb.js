import{j as e}from"./main-BlGnCLHT.js";import{r as o,L as $}from"./router-C15yhWin.js";import{a as x,F as A}from"./auditoriaService-COzppVk9.js";import{n as u}from"./index-CsOmCsbp.js";import{F as S}from"./ArrowPathIcon-DvGuXmm8.js";import{F as D}from"./DocumentArrowDownIcon-Bp61FGwk.js";import{F as z}from"./MagnifyingGlassIcon-DxjVcYIb.js";import{F as I}from"./FunnelIcon-PU3yDtaQ.js";import{F as T}from"./UserIcon-Crv8uqGG.js";import{F as M}from"./ComputerDesktopIcon-CRyvAujT.js";import{F as B}from"./CogIcon-BTmJ_-eZ.js";import{F as G}from"./ClockIcon-CbdR_WDb.js";import{F as O}from"./CheckCircleIcon-B-MrGrlS.js";import{F as p}from"./ExclamationTriangleIcon-Y0luX6t1.js";import{F as P}from"./EyeIcon-Cu0Wnbis.js";import{F as U}from"./ChevronLeftIcon-DrI7nw9R.js";import{F as W}from"./ChevronRightIcon-BTrjiRa8.js";import{F as h}from"./InformationCircleIcon-o8enZ7c_.js";import"./vendor-Csw2ODfV.js";import"./icons-C8WIGuh4.js";const me=()=>{const[d,b]=o.useState([]),[j,g]=o.useState(!0),[y,N]=o.useState([]),[t,r]=o.useState({search:"",nivel:"",tipo_evento:"",usuario:"",data_inicio:"",data_fim:"",modulo:"",sucesso:""}),[a,l]=o.useState({page:1,total_pages:1,total_count:0,page_size:50}),[i,n]=o.useState([]);o.useEffect(()=>{f(),v()},[a.page,t]);const f=async()=>{try{g(!0);const s=await x.listarLogs({...t,page:a.page,page_size:a.page_size});b(s.results),l({...a,total_pages:Math.ceil(s.count/a.page_size),total_count:s.count})}catch(s){console.error("Erro ao carregar logs:",s),u.error("Erro ao carregar logs de auditoria")}finally{g(!1)}},v=async()=>{try{const s=await x.listarTiposEvento();N(s)}catch(s){console.error("Erro ao carregar tipos de evento:",s)}},w=()=>{l({...a,page:1})},F=()=>{r({search:"",nivel:"",tipo_evento:"",usuario:"",data_inicio:"",data_fim:"",modulo:"",sucesso:""}),l({...a,page:1})},_=async()=>{try{await x.exportarLogs(t),u.success("Exportação iniciada com sucesso")}catch(s){console.error("Erro ao exportar logs:",s),u.error("Erro ao exportar logs")}},k=()=>{i.length===d.length?n([]):n(d.map(s=>s.id))},R=s=>{i.includes(s)?n(i.filter(m=>m!==s)):n([...i,s])},C=s=>{switch(s){case"CRITICAL":return e.jsx(A,{className:"h-5 w-5 text-red-600"});case"ERROR":return e.jsx(p,{className:"h-5 w-5 text-orange-600"});case"WARNING":return e.jsx(p,{className:"h-5 w-5 text-yellow-600"});case"INFO":return e.jsx(h,{className:"h-5 w-5 text-green-600"});case"DEBUG":return e.jsx(h,{className:"h-5 w-5 text-blue-600"});default:return e.jsx(h,{className:"h-5 w-5 text-gray-600"})}},E=s=>new Date(s).toLocaleString("pt-BR"),L=s=>s?s<1e3?`${s}ms`:`${(s/1e3).toFixed(2)}s`:"N/A";return j?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Logs de Auditoria"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Visualização e análise de todos os logs do sistema"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:f,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Atualizar"]}),e.jsxs("button",{onClick:_,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Exportar"]})]})]})}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Filtros Avançados"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.search,onChange:s=>r({...t,search:s.target.value}),placeholder:"Buscar em descrição, detalhes...",className:"w-full pl-10 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"}),e.jsx(z,{className:"h-5 w-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nível"}),e.jsxs("select",{value:t.nivel,onChange:s=>r({...t,nivel:s.target.value}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"CRITICAL",children:"Crítico"}),e.jsx("option",{value:"ERROR",children:"Erro"}),e.jsx("option",{value:"WARNING",children:"Aviso"}),e.jsx("option",{value:"INFO",children:"Info"}),e.jsx("option",{value:"DEBUG",children:"Debug"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Evento"}),e.jsxs("select",{value:t.tipo_evento,onChange:s=>r({...t,tipo_evento:s.target.value}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),y.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:t.sucesso,onChange:s=>r({...t,sucesso:s.target.value}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"true",children:"Sucesso"}),e.jsx("option",{value:"false",children:"Erro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Usuário"}),e.jsx("input",{type:"text",value:t.usuario,onChange:s=>r({...t,usuario:s.target.value}),placeholder:"Filtrar por usuário",className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Módulo"}),e.jsx("input",{type:"text",value:t.modulo,onChange:s=>r({...t,modulo:s.target.value}),placeholder:"Filtrar por módulo",className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Início"}),e.jsx("input",{type:"date",value:t.data_inicio,onChange:s=>r({...t,data_inicio:s.target.value}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:t.data_fim,onChange:s=>r({...t,data_fim:s.target.value}),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:F,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Limpar Filtros"}),e.jsxs("button",{onClick:w,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Aplicar Filtros"]})]})]}),i.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[i.length," log(s) selecionado(s)"]})}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{onClick:()=>n([]),className:"text-sm text-blue-600 hover:text-blue-800",children:"Desmarcar todos"})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Logs (",a.total_count.toLocaleString(),")"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["Página ",a.page," de ",a.total_pages]})})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:i.length===d.length&&d.length>0,onChange:k,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nível"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ação"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuário"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"IP"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Módulo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duração"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data/Hora"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:i.includes(s.id),onChange:()=>R(s.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[C(s.nivel),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-900",children:s.nivel})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:s.acao}),e.jsx("div",{className:"text-sm text-gray-500 max-w-xs truncate",children:s.descricao})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:s.usuario||"Sistema"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:s.ip_origem||"N/A"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:s.modulo||"N/A"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:L(s.duracao_ms)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:E(s.timestamp)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.sucesso?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"Sucesso"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(p,{className:"h-3 w-3 mr-1"}),"Erro"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx($,{to:`/auditoria/logs/${s.id}`,className:"text-blue-600 hover:text-blue-900",children:e.jsx(P,{className:"h-4 w-4"})})})]},s.id))})]})}),a.total_pages>1&&e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>l({...a,page:a.page-1}),disabled:a.page===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Anterior"}),e.jsx("button",{onClick:()=>l({...a,page:a.page+1}),disabled:a.page===a.total_pages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Próxima"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Mostrando ",e.jsx("span",{className:"font-medium",children:(a.page-1)*a.page_size+1})," a"," ",e.jsx("span",{className:"font-medium",children:Math.min(a.page*a.page_size,a.total_count)})," de"," ",e.jsx("span",{className:"font-medium",children:a.total_count})," resultados"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e.jsx("button",{onClick:()=>l({...a,page:a.page-1}),disabled:a.page===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:e.jsx(U,{className:"h-5 w-5"})}),Array.from({length:Math.min(5,a.total_pages)},(s,m)=>{const c=m+1;return e.jsx("button",{onClick:()=>l({...a,page:c}),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${c===a.page?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:c},c)}),e.jsx("button",{onClick:()=>l({...a,page:a.page+1}),disabled:a.page===a.total_pages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:e.jsx(W,{className:"h-5 w-5"})})]})})]})]})]})]})};export{me as default};
