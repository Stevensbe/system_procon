import{j as e,u as y}from"./main-DVdFXPbZ.js";import{r as i,L as d}from"./router-C15yhWin.js";import"./vendor-Csw2ODfV.js";import"./icons-C8WIGuh4.js";function w(){const[a,n]=i.useState(null),[s,c]=i.useState(1),[f,u]=i.useState(!0),[h,x]=i.useState(""),[o,g]=i.useState({});i.useEffect(()=>{(async()=>{u(!0),x("");try{console.log(`üîÑ Carregando autos diversos da p√°gina ${s}...`);const t=await y(s,o);console.log("‚úÖ Dados recebidos:",t),t&&t.results&&Array.isArray(t.results)?(n(t),console.log(`üìä ${t.results.length} autos carregados de ${t.count} total`)):Array.isArray(t)?(n({results:t,count:t.length,next:null,previous:null,current_page:s,total_pages:Math.ceil(t.length/10)}),console.log(`üìä ${t.length} autos carregados (array direto)`)):(console.warn("‚ö†Ô∏è Estrutura inesperada, usando fallback:",t),n({results:[],count:0,next:null,previous:null,current_page:s,total_pages:0,debug_data:t}),x("Dados recebidos em formato inesperado"))}catch(t){console.error("‚ùå Erro ao carregar autos:",t),x(t.message||"Erro ao carregar autos diversos."),n({results:[],count:0,next:null,previous:null,current_page:s,total_pages:0})}finally{u(!1)}})()},[s,o]);const p=async()=>{console.log("üîç Executando debug da API...");try{const r=await y(1,{});console.log("üìã Resultado do debug:",r)}catch(r){console.error("‚ùå Erro no debug:",r)}},m=r=>[r.publicidade_enganosa,r.precos_fora_padrao,r.ausencia_precos,r.precos_eletronico_fora_padrao,r.ausencia_precos_eletronico,r.fracionados_fora_padrao,r.ausencia_desconto_visibilidade,r.ausencia_exemplar_cdc,r.substituicao_troco].filter(Boolean).length;if(f)return e.jsx("div",{className:"flex justify-center items-center p-8 min-h-64 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 dark:border-purple-400"}),e.jsx("div",{className:"text-lg text-gray-600 dark:text-gray-300 transition-colors duration-300",children:"Carregando autos diversos..."}),e.jsxs("div",{className:"text-sm text-gray-400 dark:text-gray-500 transition-colors duration-300",children:["P√°gina ",s]})]})});if(h)return e.jsx("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-200 px-6 py-4 rounded-lg transition-colors duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Erro ao carregar dados"}),e.jsx("p",{className:"mt-2",children:h}),e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("strong",{children:"P√°gina solicitada:"})," ",s,e.jsx("br",{}),e.jsx("strong",{children:"Filtros aplicados:"})," ",JSON.stringify(o)]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"üîÑ Recarregar"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors text-sm",children:"üîç Debug API"})]})]}),(a==null?void 0:a.debug_data)&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:"üìä Dados recebidos (Debug)"}),e.jsx("pre",{className:"mt-2 p-3 bg-red-50 rounded text-xs overflow-auto max-h-40",children:JSON.stringify(a.debug_data,null,2)})]})]})});if(!a||!a.results)return e.jsx("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900/20 border border-yellow-400 dark:border-yellow-800 text-yellow-700 dark:text-yellow-200 px-6 py-4 rounded-lg transition-colors duration-300",children:[e.jsx("h3",{className:"font-bold",children:"Nenhum dado dispon√≠vel"}),e.jsx("p",{className:"mt-2",children:"N√£o foi poss√≠vel carregar os dados dos autos diversos."}),e.jsx("button",{onClick:p,className:"mt-3 px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors",children:"üîç Diagnosticar Problema"})]})});const b=a.results;return e.jsxs("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white transition-colors duration-300",children:"Autos de Constata√ß√£o - Legisla√ß√£o Diversas"}),e.jsx("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300 transition-colors duration-300",children:a.count>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:a.count})," auto",a.count!==1?"s":""," encontrado",a.count!==1?"s":"",a.total_pages>1&&e.jsxs("span",{className:"ml-2",children:["‚Ä¢ P√°gina ",a.current_page||s," de ",a.total_pages]})]}):"Nenhum auto encontrado"})]}),e.jsxs("div",{className:"flex gap-3",children:[!1,e.jsx(d,{to:"/fiscalizacao/diversos/novo",className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"‚ûï Novo Auto"})]})]}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-[#1a1d21] rounded-lg border border-gray-200 dark:border-gray-700 transition-colors duration-300",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 transition-colors duration-300",children:"Munic√≠pio:"}),e.jsx("input",{type:"text",placeholder:"Filtrar por munic√≠pio",className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors duration-300",onChange:r=>{const t={...o};r.target.value?t.municipio=r.target.value:delete t.municipio,g(t)}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Advert√™ncia:"}),e.jsxs("select",{className:"px-3 py-1 border border-gray-300 rounded text-sm",onChange:r=>{const t={...o};r.target.value!==""?t.aplicar_advertencia=r.target.value:delete t.aplicar_advertencia,g(t)},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"true",children:"Com Advert√™ncia"}),e.jsx("option",{value:"false",children:"Sem Advert√™ncia"})]})]}),Object.keys(o).length>0&&e.jsx("button",{onClick:()=>g({}),className:"px-3 py-1 bg-red-100 text-red-700 rounded text-sm hover:bg-red-200 transition-colors",children:"‚úñÔ∏è Limpar filtros"})]})}),b.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-[#1a1d21] rounded-lg shadow border-2 border-dashed border-gray-300 dark:border-gray-600 transition-colors duration-300",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üìã"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white mb-2 transition-colors duration-300",children:"Nenhum auto diversos encontrado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 transition-colors duration-300",children:Object.keys(o).length>0?"Nenhum auto corresponde aos filtros aplicados.":"Ainda n√£o h√° autos diversos cadastrados."}),e.jsx(d,{to:"/fiscalizacao/diversos/novo",className:"inline-flex items-center px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"‚ûï Criar Primeiro Auto"})]}):e.jsx("div",{className:"bg-white dark:bg-[#1a1d21] rounded-lg shadow overflow-hidden transition-colors duration-300",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"N√∫mero"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Estabelecimento"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"CNPJ"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Munic√≠pio"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Data"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Irregularidades"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Advert√™ncia"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"A√ß√µes"})]})}),e.jsx("tbody",{children:b.map(r=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsx("code",{className:"bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded text-sm font-mono text-gray-900 dark:text-white transition-colors duration-300",children:r.numero||`DIV-${r.id}`})}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white transition-colors duration-300",children:r.razao_social||"N/A"}),r.nome_fantasia&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300",children:r.nome_fantasia})]}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300 transition-colors duration-300",children:r.cnpj||"N/A"}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300 transition-colors duration-300",children:r.municipio||"N/A"}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300 transition-colors duration-300",children:r.data_fiscalizacao?new Date(r.data_fiscalizacao+"T00:00:00").toLocaleDateString("pt-BR"):"Data n√£o informada"}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m(r)>0?"bg-red-100 text-red-800 border border-red-200":"bg-green-100 text-green-800 border border-green-200"}`,children:[m(r)>0?"‚ö†Ô∏è":"‚úÖ"," ",m(r)," irregularidade(s)"]})}),e.jsx("td",{className:"p-4",children:r.aplicar_advertencia?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 border border-yellow-200",children:"üìù Aplicada"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 border border-gray-200",children:"‚ûñ N√£o aplicada"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{to:`/fiscalizacao/diversos/${r.id}`,className:"text-purple-600 hover:text-purple-800 font-medium text-sm transition-colors",children:"üëÅÔ∏è Ver"}),e.jsx(d,{to:`/fiscalizacao/diversos/${r.id}/editar`,className:"text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors",children:"‚úèÔ∏è Editar"})]})})]},r.id))})]})})}),a.total_pages>1&&e.jsxs("div",{className:"flex justify-center items-center gap-4 mt-8",children:[e.jsx("button",{onClick:()=>c(s-1),disabled:!a.previous,className:"px-4 py-2 bg-gray-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:"‚¨ÖÔ∏è Anterior"}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:Math.min(5,a.total_pages)},(r,t)=>{const l=s<=3?t+1:s-2+t;return l>a.total_pages?null:e.jsx("button",{onClick:()=>c(l),className:`px-3 py-2 rounded transition-colors ${l===s?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:l},l)})}),e.jsx("button",{onClick:()=>c(s+1),disabled:!a.next,className:"px-4 py-2 bg-gray-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:"Pr√≥xima ‚û°Ô∏è"})]}),!1]})}export{w as default};
