import{j as e}from"./main-DVdFXPbZ.js";import{u as I,e as z,r as c}from"./router-C15yhWin.js";import{c as u}from"./cobrancaService-y4NTKzV9.js";import{n as i}from"./index-CsOmCsbp.js";import{L as v}from"./LoadingSpinner-BMSYS9qZ.js";import{F as V}from"./ArrowLeftIcon-B1Aara0h.js";import{F as q}from"./XMarkIcon-C8R2LFm1.js";import{F as L}from"./DocumentCheckIcon-CEHDhKx0.js";import"./vendor-Csw2ODfV.js";import"./icons-C8WIGuh4.js";const Y=()=>{const m=I(),{id:t}=z(),[h,b]=c.useState(!1),[p,g]=c.useState(!1),[j,y]=c.useState([]),[N,C]=c.useState([]),[r,x]=c.useState({numero:"",tipo:"",processo:"",multa:"",devedor:"",valor_original:"",valor_atualizado:"",data_vencimento:"",data_emissao:"",status:"PENDENTE",forma_pagamento:"",parcelas:1,observacoes:"",documentos_anexos:[]}),w=[{value:"MULTA",label:"Multa"},{value:"TAXA",label:"Taxa"},{value:"EMOLUMENTO",label:"Emolumento"},{value:"CUSTA",label:"Custa"},{value:"OUTROS",label:"Outros"}],E=[{value:"PENDENTE",label:"Pendente",color:"text-yellow-600"},{value:"EM_PROCESSAMENTO",label:"Em Processamento",color:"text-blue-600"},{value:"PAGO",label:"Pago",color:"text-green-600"},{value:"VENCIDO",label:"Vencido",color:"text-red-600"},{value:"CANCELADO",label:"Cancelado",color:"text-gray-600"}],_=[{value:"BOLETO",label:"Boleto Bancário"},{value:"PIX",label:"PIX"},{value:"CARTAO_CREDITO",label:"Cartão de Crédito"},{value:"CARTAO_DEBITO",label:"Cartão de Débito"},{value:"TRANSFERENCIA",label:"Transferência Bancária"},{value:"DINHEIRO",label:"Dinheiro"}];c.useEffect(()=>{D(),t&&O()},[t]);const D=async()=>{try{b(!0);const a=await u.listarProcessos();y(a);const o=await u.listarMultas();C(o)}catch(a){console.error("Erro ao carregar dados iniciais:",a),i.error("Erro ao carregar dados iniciais")}finally{b(!1)}},O=async()=>{try{b(!0);const a=await u.obterCobranca(t);x(a)}catch(a){console.error("Erro ao carregar cobrança:",a),i.error("Erro ao carregar cobrança"),m("/cobranca")}finally{b(!1)}},s=a=>{const{name:o,value:l}=a.target;x(n=>({...n,[o]:l}))},S=a=>{const o=Array.from(a.target.files);x(l=>({...l,documentos_anexos:[...l.documentos_anexos,...o]}))},A=a=>{x(o=>({...o,documentos_anexos:o.documentos_anexos.filter((l,n)=>n!==a)}))},f=()=>{const a=parseFloat(r.valor_original)||0,o=new Date(r.data_vencimento),n=Math.max(0,Math.floor((new Date-o)/(1e3*60*60*24))),d=.01,P=.02;if(n>0){const F=n/30,R=a*d*F,M=a*P;return a+R+M}return a},T=()=>{const a=[];return r.numero.trim()||a.push("Número da cobrança é obrigatório"),r.tipo||a.push("Tipo de cobrança é obrigatório"),r.devedor.trim()||a.push("Devedor é obrigatório"),(!r.valor_original||parseFloat(r.valor_original)<=0)&&a.push("Valor original deve ser maior que zero"),r.data_vencimento||a.push("Data de vencimento é obrigatória"),r.data_emissao||a.push("Data de emissão é obrigatória"),a},k=async a=>{a.preventDefault();const o=T();if(o.length>0){o.forEach(d=>i.error(d));return}const l=f(),n={...r,valor_atualizado:l.toFixed(2)};try{g(!0),t?(await u.atualizarCobranca(t,n),i.success("Cobrança atualizada com sucesso!")):(await u.criarCobranca(n),i.success("Cobrança criada com sucesso!")),m("/cobranca")}catch(d){console.error("Erro ao salvar cobrança:",d),i.error("Erro ao salvar cobrança")}finally{g(!1)}};return h?e.jsx(v,{}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>m("/cobranca"),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(V,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t?"Editar Cobrança":"Nova Cobrança"}),e.jsx("p",{className:"text-gray-600",children:t?"Edite os dados da cobrança":"Crie uma nova cobrança"})]})]})})}),e.jsxs("form",{onSubmit:k,className:"bg-white shadow-lg rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Número da Cobrança *"}),e.jsx("input",{type:"text",name:"numero",value:r.numero,onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: COB-2025-001",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Cobrança *"}),e.jsxs("select",{name:"tipo",value:r.tipo,onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Selecione o tipo"}),w.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Processo"}),e.jsxs("select",{name:"processo",value:r.processo,onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um processo"}),j.map(a=>e.jsxs("option",{value:a.id,children:[a.numero," - ",a.titulo]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Multa"}),e.jsxs("select",{name:"multa",value:r.multa,onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione uma multa"}),N.map(a=>e.jsxs("option",{value:a.id,children:[a.numero," - R$ ",a.valor]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Devedor *"}),e.jsx("input",{type:"text",name:"devedor",value:r.devedor,onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nome do devedor",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsx("select",{name:"status",value:r.status,onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:E.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Original *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",name:"valor_original",value:r.valor_original,onChange:s,step:"0.01",min:"0",className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Atualizado"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-gray-500",children:"R$"}),e.jsx("input",{type:"text",value:f().toFixed(2),className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md bg-gray-50",readOnly:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de Emissão *"}),e.jsx("input",{type:"date",name:"data_emissao",value:r.data_emissao,onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de Vencimento *"}),e.jsx("input",{type:"date",name:"data_vencimento",value:r.data_vencimento,onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento"}),e.jsxs("select",{name:"forma_pagamento",value:r.forma_pagamento,onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione a forma"}),_.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Número de Parcelas"}),e.jsx("input",{type:"number",name:"parcelas",value:r.parcelas,onChange:s,min:"1",max:"12",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observações"}),e.jsx("textarea",{name:"observacoes",value:r.observacoes,onChange:s,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Observações adicionais"})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documentos Anexos"}),e.jsx("input",{type:"file",multiple:!0,onChange:S,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png"}),r.documentos_anexos.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:r.documentos_anexos.map((a,o)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:a.name}),e.jsx("button",{type:"button",onClick:()=>A(o),className:"text-red-500 hover:text-red-700",children:e.jsx(q,{className:"h-4 w-4"})})]},o))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>m("/cobranca"),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:p,className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[p?e.jsx(v,{size:"sm"}):e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:p?"Salvando...":"Salvar Cobrança"})]})]})]})]})})};export{Y as default};
