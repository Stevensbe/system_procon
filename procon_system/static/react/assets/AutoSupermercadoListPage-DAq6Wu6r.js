import{j as e,f}from"./main-BZolao6g.js";import{r as d,L as l}from"./router-Cgdj9vyr.js";import"./vendor-Csw2ODfV.js";import"./icons-qiKTog5F.js";function w(){const[t,n]=d.useState(null),[s,c]=d.useState(1),[y,u]=d.useState(!0),[h,g]=d.useState(""),[o,x]=d.useState({});d.useEffect(()=>{(async()=>{u(!0),g("");try{console.log(`🔄 Carregando autos de supermercados da página ${s}...`);const a=await f(s,o);console.log("✅ Dados recebidos:",a),a&&a.results&&Array.isArray(a.results)?(n(a),console.log(`📊 ${a.results.length} autos carregados de ${a.count} total`)):Array.isArray(a)?(n({results:a,count:a.length,next:null,previous:null,current_page:s,total_pages:Math.ceil(a.length/10)}),console.log(`📊 ${a.length} autos carregados (array direto)`)):(console.warn("⚠️ Estrutura inesperada, usando fallback:",a),n({results:[],count:0,next:null,previous:null,current_page:s,total_pages:0,debug_data:a}),g("Dados recebidos em formato inesperado"))}catch(a){console.error("❌ Erro ao carregar autos:",a),g(a.message||"Erro ao carregar autos de supermercado."),n({results:[],count:0,next:null,previous:null,current_page:s,total_pages:0})}finally{u(!1)}})()},[s,o]);const p=async()=>{console.log("🔍 Executando debug da API...");try{const r=await listarAutosSupermercados(1,{});console.log("📋 Resultado do debug:",r)}catch(r){console.error("❌ Erro no debug:",r)}},m=r=>[r.produtos_vencidos,r.embalagem_violada,r.lata_amassada,r.sem_validade,r.validade_ilegivel,r.mal_armazenados,r.produtos_descongelados,r.publicidade_enganosa,r.obstrucao_monitor,r.precos_fora_padrao,r.ausencia_precos,r.fracionados_fora_padrao,r.ausencia_desconto_visibilidade,r.ausencia_placas_promocao].filter(Boolean).length;if(y)return e.jsx("div",{className:"flex justify-center items-center p-8 min-h-64 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 dark:border-green-400"}),e.jsx("div",{className:"text-lg text-gray-600 dark:text-gray-300 transition-colors duration-300",children:"Carregando autos de supermercado..."}),e.jsxs("div",{className:"text-sm text-gray-400 dark:text-gray-500 transition-colors duration-300",children:["Página ",s]})]})});if(h)return e.jsx("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-200 px-6 py-4 rounded-lg transition-colors duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Erro ao carregar dados"}),e.jsx("p",{className:"mt-2",children:h}),e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("strong",{children:"Página solicitada:"})," ",s,e.jsx("br",{}),e.jsx("strong",{children:"Filtros aplicados:"})," ",JSON.stringify(o)]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"🔄 Recarregar"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors text-sm",children:"🔍 Debug API"})]})]}),(t==null?void 0:t.debug_data)&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:"📊 Dados recebidos (Debug)"}),e.jsx("pre",{className:"mt-2 p-3 bg-red-50 rounded text-xs overflow-auto max-h-40",children:JSON.stringify(t.debug_data,null,2)})]})]})});if(!t||!t.results)return e.jsx("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900/20 border border-yellow-400 dark:border-yellow-800 text-yellow-700 dark:text-yellow-200 px-6 py-4 rounded-lg transition-colors duration-300",children:[e.jsx("h3",{className:"font-bold",children:"Nenhum dado disponível"}),e.jsx("p",{className:"mt-2",children:"Não foi possível carregar os dados dos autos de supermercado."}),e.jsx("button",{onClick:p,className:"mt-3 px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors",children:"🔍 Diagnosticar Problema"})]})});const b=t.results;return e.jsxs("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white transition-colors duration-300",children:"Autos de Constatação - Supermercados"}),e.jsx("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300 transition-colors duration-300",children:t.count>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:t.count})," auto",t.count!==1?"s":""," encontrado",t.count!==1?"s":"",t.total_pages>1&&e.jsxs("span",{className:"ml-2",children:["• Página ",t.current_page||s," de ",t.total_pages]})]}):"Nenhum auto encontrado"})]}),e.jsxs("div",{className:"flex gap-3",children:[!1,e.jsx(l,{to:"/fiscalizacao/supermercados/novo",className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"➕ Novo Auto"})]})]}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-[#1a1d21] rounded-lg border border-gray-200 dark:border-gray-700 transition-colors duration-300",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 transition-colors duration-300",children:"Município:"}),e.jsx("input",{type:"text",placeholder:"Filtrar por município",className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors duration-300",onChange:r=>{const a={...o};r.target.value?a.municipio=r.target.value:delete a.municipio,x(a)}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 transition-colors duration-300",children:"Com irregularidades:"}),e.jsxs("select",{className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors duration-300",onChange:r=>{const a={...o};r.target.value!==""?a.tem_irregularidades=r.target.value:delete a.tem_irregularidades,x(a)},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"true",children:"Com irregularidades"}),e.jsx("option",{value:"false",children:"Sem irregularidades"})]})]}),Object.keys(o).length>0&&e.jsx("button",{onClick:()=>x({}),className:"px-3 py-1 bg-red-100 text-red-700 rounded text-sm hover:bg-red-200 transition-colors",children:"✖️ Limpar filtros"})]})}),b.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-[#1a1d21] rounded-lg shadow border-2 border-dashed border-gray-300 dark:border-gray-600 transition-colors duration-300",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🛒"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white mb-2 transition-colors duration-300",children:"Nenhum auto de supermercado encontrado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 transition-colors duration-300",children:Object.keys(o).length>0?"Nenhum auto corresponde aos filtros aplicados.":"Ainda não há autos de supermercado cadastrados."}),e.jsx(l,{to:"/fiscalizacao/supermercados/novo",className:"inline-flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"➕ Criar Primeiro Auto"})]}):e.jsx("div",{className:"bg-white dark:bg-[#1a1d21] rounded-lg shadow overflow-hidden transition-colors duration-300",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Número"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Estabelecimento"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"CNPJ"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Município"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Data"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Irregularidades"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Ações"})]})}),e.jsx("tbody",{children:b.map(r=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsx("code",{className:"bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded text-sm font-mono text-gray-900 dark:text-white transition-colors duration-300",children:r.numero||`SUPER-${r.id}`})}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white transition-colors duration-300",children:r.razao_social||"N/A"}),r.nome_fantasia&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300",children:r.nome_fantasia})]}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300 transition-colors duration-300",children:r.cnpj||"N/A"}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300 transition-colors duration-300",children:r.municipio||"N/A"}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300 transition-colors duration-300",children:r.data_fiscalizacao?new Date(r.data_fiscalizacao+"T00:00:00").toLocaleDateString("pt-BR"):"Data não informada"}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m(r)>0?"bg-red-100 text-red-800 border border-red-200":"bg-green-100 text-green-800 border border-green-200"}`,children:[m(r)>0?"⚠️":"✅"," ",m(r)," irregularidade(s)"]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{to:`/fiscalizacao/supermercados/${r.id}`,className:"text-green-600 hover:text-green-800 font-medium text-sm transition-colors",children:"👁️ Ver"}),e.jsx(l,{to:`/fiscalizacao/supermercados/${r.id}/editar`,className:"text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors",children:"✏️ Editar"})]})})]},r.id))})]})})}),t.total_pages>1&&e.jsxs("div",{className:"flex justify-center items-center gap-4 mt-8",children:[e.jsx("button",{onClick:()=>c(s-1),disabled:!t.previous,className:"px-4 py-2 bg-gray-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:"⬅️ Anterior"}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:Math.min(5,t.total_pages)},(r,a)=>{const i=s<=3?a+1:s-2+a;return i>t.total_pages?null:e.jsx("button",{onClick:()=>c(i),className:`px-3 py-2 rounded transition-colors ${i===s?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:i},i)})}),e.jsx("button",{onClick:()=>c(s+1),disabled:!t.next,className:"px-4 py-2 bg-gray-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:"Próxima ➡️"})]}),!1]})}export{w as default};
