import{j as e}from"./main-QkSqPps8.js";import{u as q,r as l,L as y}from"./router-C15yhWin.js";import{L}from"./LoadingSpinner-CioJYzaJ.js";import{u as U}from"./useNotification-Bm6NCblX.js";import{p as u}from"./protocoloTramitacaoService-BMVlb2-k.js";import{F as B}from"./ArrowLeftIcon-B1Aara0h.js";import{F as I}from"./DocumentTextIcon-o9njoXYt.js";import{F as m}from"./ArrowPathIcon-DvGuXmm8.js";import{F as J}from"./MagnifyingGlassIcon-DxjVcYIb.js";import{F as M}from"./CheckCircleIcon-B-MrGrlS.js";import{F as V}from"./PaperClipIcon-COa5Xtiy.js";import"./vendor-Csw2ODfV.js";import"./icons-C8WIGuh4.js";const te=()=>{const w=q(),[D,x]=l.useState(!1),[b,p]=l.useState(!1),{showNotification:n}=U(),[s,d]=l.useState({numeroProtocolo:"",setorOrigem:"",setorDestino:"",responsavelDestino:"",prazoResposta:"",prioridade:"normal",assunto:"",observacoes:"",documentosAnexos:[],tipoTramitacao:"encaminhamento"}),[r,g]=l.useState({}),[h,f]=l.useState([]),[P,S]=l.useState([]),[i,v]=l.useState(null),[j,N]=l.useState(!1),R=[{value:"baixa",label:"Baixa",color:"text-green-600"},{value:"normal",label:"Normal",color:"text-blue-600"},{value:"alta",label:"Alta",color:"text-yellow-600"},{value:"urgente",label:"Urgente",color:"text-red-600"}],F=[{value:"encaminhamento",label:"Encaminhamento"},{value:"devolucao",label:"Devolução"},{value:"informacao",label:"Solicitação de Informação"},{value:"parecer",label:"Solicitação de Parecer"},{value:"execucao",label:"Execução"},{value:"arquivamento",label:"Arquivamento"},{value:"redistribuicao",label:"Redistribuição"}];l.useEffect(()=>{C()},[]);const C=async()=>{try{x(!0),await Promise.all([A(),E()])}catch{n("Erro ao carregar dados auxiliares","error")}finally{x(!1)}},A=async()=>{try{const o=await u.listarSetores();f(o.results||o||[])}catch(o){console.error("Erro ao carregar setores:",o),f([{id:1,nome:"Protocolo",sigla:"PROT"},{id:2,nome:"Jurídico",sigla:"JUR"},{id:3,nome:"Fiscalização",sigla:"FISC"},{id:4,nome:"Cobrança",sigla:"COBR"},{id:5,nome:"Administrativo",sigla:"ADM"}])}},E=async()=>{try{S([{id:1,nome:"Dr. João Silva",setor:"Jurídico"},{id:2,nome:"Dra. Maria Santos",setor:"Fiscalização"},{id:3,nome:"Sr. Pedro Costa",setor:"Cobrança"},{id:4,nome:"Sra. Ana Oliveira",setor:"Administrativo"}])}catch(o){console.error("Erro ao carregar usuários:",o)}},T=async()=>{if(!s.numeroProtocolo.trim()){n("Digite o número do protocolo","warning");return}try{N(!0);const o=await u.consultarPorNumero(s.numeroProtocolo);o.results&&o.results.length>0?(v(o.results[0]),d(a=>({...a,setorOrigem:o.results[0].setor_atual||"",assunto:o.results[0].assunto||""})),n("Protocolo encontrado!","success")):(v(null),n("Protocolo não encontrado","error"))}catch(o){console.error("Erro ao buscar protocolo:",o),n("Erro ao buscar protocolo","error")}finally{N(!1)}},t=(o,a)=>{d(c=>({...c,[o]:a})),r[o]&&g(c=>({...c,[o]:""}))},k=()=>{const o={};return s.numeroProtocolo||(o.numeroProtocolo="Número do protocolo é obrigatório"),s.setorDestino||(o.setorDestino="Setor de destino é obrigatório"),s.responsavelDestino||(o.responsavelDestino="Responsável de destino é obrigatório"),s.assunto||(o.assunto="Assunto é obrigatório"),s.prazoResposta||(o.prazoResposta="Prazo de resposta é obrigatório"),g(o),Object.keys(o).length===0},z=async o=>{if(o.preventDefault(),!k()){n("Por favor, corrija os erros no formulário","error");return}try{p(!0);const a={protocolo:(i==null?void 0:i.id)||s.numeroProtocolo,setor_origem:s.setorOrigem,setor_destino:s.setorDestino,responsavel_destino:s.responsavelDestino,prazo_resposta:s.prazoResposta,prioridade:s.prioridade,assunto:s.assunto,observacoes:s.observacoes,tipo_tramitacao:s.tipoTramitacao,documentos_anexos:s.documentosAnexos};await u.criarTramitacao(a),n("Documento tramitado com sucesso!","success"),w("/tramitacao/lista")}catch(a){console.error("Erro ao tramitar documento:",a),n("Erro ao tramitar documento","error")}finally{p(!1)}},O=o=>{const a=Array.from(o.target.files);d(c=>({...c,documentosAnexos:[...c.documentosAnexos,...a]}))},$=o=>{d(a=>({...a,documentosAnexos:a.documentosAnexos.filter((c,_)=>_!==o)}))};return D?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(L,{})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(y,{to:"/tramitacao",className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(B,{className:"w-5 h-5 mr-2"}),"Voltar"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tramitar Documento"}),e.jsx("p",{className:"text-gray-600",children:"Envie documentos entre setores do PROCON"})]})]})})}),e.jsxs("form",{onSubmit:z,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(I,{className:"w-5 h-5 mr-2"}),"Buscar Protocolo"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Número do Protocolo"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:s.numeroProtocolo,onChange:o=>t("numeroProtocolo",o.target.value),className:`flex-1 px-3 py-2 border rounded-l-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${r.numeroProtocolo?"border-red-500":"border-gray-300"}`,placeholder:"Digite o número do protocolo"}),e.jsx("button",{type:"button",onClick:T,disabled:j,className:"px-4 py-2 bg-blue-600 text-white rounded-r-md hover:bg-blue-700 disabled:opacity-50 flex items-center",children:j?e.jsx(m,{className:"w-4 h-4 animate-spin"}):e.jsx(J,{className:"w-4 h-4"})})]}),r.numeroProtocolo&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.numeroProtocolo})]})}),i&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"w-5 h-5 text-green-600 mr-2"}),e.jsx("h3",{className:"font-medium text-green-900",children:"Protocolo Encontrado"})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Número:"})," ",i.numero]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Interessado:"})," ",i.interessado]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Assunto:"})," ",i.assunto]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",i.status]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(m,{className:"w-5 h-5 mr-2"}),"Dados da Tramitação"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Setor de Origem"}),e.jsxs("select",{value:s.setorOrigem,onChange:o=>t("setorOrigem",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Selecione o setor"}),h.map(o=>e.jsxs("option",{value:o.id,children:[o.sigla," - ",o.nome]},o.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Setor de Destino *"}),e.jsxs("select",{value:s.setorDestino,onChange:o=>t("setorDestino",o.target.value),className:`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${r.setorDestino?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione o setor"}),h.map(o=>e.jsxs("option",{value:o.id,children:[o.sigla," - ",o.nome]},o.id))]}),r.setorDestino&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.setorDestino})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Responsável de Destino *"}),e.jsxs("select",{value:s.responsavelDestino,onChange:o=>t("responsavelDestino",o.target.value),className:`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${r.responsavelDestino?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione o responsável"}),P.map(o=>e.jsxs("option",{value:o.id,children:[o.nome," (",o.setor,")"]},o.id))]}),r.responsavelDestino&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.responsavelDestino})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Tramitação"}),e.jsx("select",{value:s.tipoTramitacao,onChange:o=>t("tipoTramitacao",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:F.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prazo de Resposta *"}),e.jsx("input",{type:"date",value:s.prazoResposta,onChange:o=>t("prazoResposta",o.target.value),className:`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${r.prazoResposta?"border-red-500":"border-gray-300"}`}),r.prazoResposta&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.prazoResposta})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prioridade"}),e.jsx("select",{value:s.prioridade,onChange:o=>t("prioridade",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:R.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assunto *"}),e.jsx("input",{type:"text",value:s.assunto,onChange:o=>t("assunto",o.target.value),className:`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${r.assunto?"border-red-500":"border-gray-300"}`,placeholder:"Digite o assunto da tramitação"}),r.assunto&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.assunto})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observações"}),e.jsx("textarea",{value:s.observacoes,onChange:o=>t("observacoes",o.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Digite observações adicionais..."})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documentos Anexos"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-md p-6 text-center",children:[e.jsx(V,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("input",{type:"file",multiple:!0,onChange:O,className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-700 font-medium",children:"Clique para selecionar arquivos"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"ou arraste e solte arquivos aqui"})]}),s.documentosAnexos.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Arquivos selecionados:"}),e.jsx("div",{className:"space-y-2",children:s.documentosAnexos.map((o,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:o.name}),e.jsx("button",{type:"button",onClick:()=>$(a),className:"text-red-600 hover:text-red-700",children:"Remover"})]},a))})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(y,{to:"/tramitacao",className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 animate-spin mr-2"}),"Tramitando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Tramitar Documento"]})})]})]})]})};export{te as default};
