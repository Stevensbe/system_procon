import{b as a,K as O,j as e,L as I}from"./main-BlGnCLHT.js";import{r as x,L as N}from"./router-C15yhWin.js";import{F as A}from"./PlusIcon-DZYmRjce.js";import{F as E}from"./DocumentTextIcon-o9njoXYt.js";import{F as M}from"./ClockIcon-CbdR_WDb.js";import{F as U}from"./CheckCircleIcon-B-MrGrlS.js";import{F as B}from"./ExclamationTriangleIcon-Y0luX6t1.js";import{F as q}from"./MagnifyingGlassIcon-DxjVcYIb.js";import{F as G}from"./FunnelIcon-PU3yDtaQ.js";import{F as T}from"./TrashIcon-CKnVykBy.js";import{F as V}from"./EyeIcon-Cu0Wnbis.js";import{F as X}from"./PencilIcon-CajHx5Rb.js";import"./vendor-Csw2ODfV.js";import"./icons-C8WIGuh4.js";class K{async listarProtocolos(t={}){const o=new URLSearchParams(t);return(await a.get(`/protocolo/protocolos/?${o}`)).data}async obterProtocolo(t){return(await a.get(`/protocolo/protocolos/${t}/`)).data}async criarProtocolo(t){return(await a.post("/protocolo/protocolos/",t)).data}async atualizarProtocolo(t,o){return(await a.patch(`/protocolo/protocolos/${t}/`,o)).data}async excluirProtocolo(t){return(await a.delete(`/protocolo/protocolos/${t}/`)).data}async gerarNumeroProtocolo(){return(await a.post("/protocolo/gerar-numero/")).data}async listarTiposProtocolo(t=!0){const o=t?"?ativo=true":"";return(await a.get(`/protocolo/tipos/${o}`)).data}async criarTipoProtocolo(t){return(await a.post("/protocolo/tipos/",t)).data}async atualizarTipoProtocolo(t,o){return(await a.patch(`/protocolo/tipos/${t}/`,o)).data}async excluirTipoProtocolo(t){return(await a.delete(`/protocolo/tipos/${t}/`)).data}async listarStatusProtocolo(){return(await a.get("/protocolo/status/")).data}async criarStatusProtocolo(t){return(await a.post("/protocolo/status/",t)).data}async atualizarStatusProtocolo(t,o){return(await a.patch(`/protocolo/status/${t}/`,o)).data}async excluirStatusProtocolo(t){return(await a.delete(`/protocolo/status/${t}/`)).data}async listarDocumentosProtocolo(t){return(await a.get(`/protocolo/protocolos/${t}/documentos/`)).data}async uploadDocumento(t,o,r={}){const i=new FormData;return i.append("arquivo",o),Object.keys(r).forEach(u=>{r[u]!==null&&r[u]!==void 0&&i.append(u,r[u])}),(await a.post(`/protocolo/protocolos/${t}/documentos/`,i,{headers:{"Content-Type":"multipart/form-data"}})).data}async removerDocumento(t,o){return(await a.delete(`/protocolo/protocolos/${t}/documentos/${o}/`)).data}async validarDocumento(t,o,r){return(await a.post(`/protocolo/protocolos/${t}/documentos/${o}/validar/`,r)).data}async listarTramitacoesProtocolo(t){return(await a.get(`/protocolo/protocolos/${t}/tramitacoes/`)).data}async criarTramitacao(t,o){return(await a.post(`/protocolo/protocolos/${t}/tramitacoes/`,o)).data}async atualizarTramitacao(t,o,r){return(await a.patch(`/protocolo/protocolos/${t}/tramitacoes/${o}/`,r)).data}async excluirTramitacao(t,o){return(await a.delete(`/protocolo/protocolos/${t}/tramitacoes/${o}/`)).data}async listarAlertasProtocolo(t){return(await a.get(`/protocolo/protocolos/${t}/alertas/`)).data}async criarAlerta(t,o){return(await a.post(`/protocolo/protocolos/${t}/alertas/`,o)).data}async marcarAlertaComoLido(t,o){return(await a.post(`/protocolo/protocolos/${t}/alertas/${o}/ler/`)).data}async excluirAlerta(t,o){return(await a.delete(`/protocolo/protocolos/${t}/alertas/${o}/`)).data}async obterConfiguracoes(){return(await a.get("/protocolo/configuracoes/")).data}async atualizarConfiguracoes(t){return(await a.patch("/protocolo/configuracoes/",t)).data}async obterEstatisticas(t="mes"){return(await a.get(`/protocolo/dashboard/estatisticas/?periodo=${t}`)).data}async obterProtocolosRecentes(t=10){return(await a.get(`/protocolo/dashboard/recentes/?limite=${t}`)).data}async obterProtocolosPendentes(t=10){return(await a.get(`/protocolo/dashboard/pendentes/?limite=${t}`)).data}async obterProtocolosVencidos(t=10){return(await a.get(`/protocolo/dashboard/vencidos/?limite=${t}`)).data}async gerarRelatorio(t={}){return(await a.post("/protocolo/relatorios/gerar/",t)).data}async exportarProtocolos(t={},o="xlsx"){const r=new URLSearchParams({...t,formato:o});return(await a.get(`/protocolo/exportar/?${r}`,{responseType:"blob"})).data}async buscaAvancada(t){return(await a.post("/protocolo/busca-avancada/",t)).data}async buscarPorNumero(t){return(await a.get(`/protocolo/buscar-por-numero/${t}/`)).data}async buscarPorInteressado(t){return(await a.get(`/protocolo/buscar-por-interessado/?termo=${encodeURIComponent(t)}`)).data}async acoesEmLote(t,o,r={}){return(await a.post("/protocolo/acoes-lote/",{ids:t,acao:o,dados:r})).data}async tramitarEmLote(t,o){return(await a.post("/protocolo/tramitar-lote/",{ids:t,...o})).data}async excluirEmLote(t){return(await a.post("/protocolo/excluir-lote/",{ids:t})).data}}const f=new K,ce=()=>{const{error:m}=O(),[t,o]=x.useState(!0),[r,i]=x.useState([]),[d,u]=x.useState({search:"",tipo:"",status:"",prioridade:"",responsavel:"",data_inicio:"",data_fim:""}),[n,w]=x.useState({page:1,page_size:20,total:0,total_pages:0}),[v,$]=x.useState([]),[P,C]=x.useState([]),[p,h]=x.useState([]);x.useEffect(()=>{j()},[d,n.page]);const j=async()=>{var s;try{o(!0);const[l,c,y]=await Promise.all([f.listarProtocolos({...d,page:n.page,page_size:n.page_size}),f.listarTiposProtocolo(),f.listarStatusProtocolo()]);i(l.results||l),$(Array.isArray(c)?c:[]),C(Array.isArray(y)?y:[]),l.count!==void 0&&w(z=>({...z,total:l.count,total_pages:Math.ceil(l.count/n.page_size)}))}catch(l){console.error("Erro ao carregar protocolos:",l),((s=l.response)==null?void 0:s.status)===401?m("Erro de autenticação. Faça login novamente."):m("Erro ao carregar protocolos"),$([]),C([]),i([])}finally{o(!1)}},g=(s,l)=>{u(c=>({...c,[s]:l})),w(c=>({...c,page:1}))},S=s=>{s.preventDefault(),j()},b=s=>{w(l=>({...l,page:s}))},k=s=>{h(l=>l.includes(s)?l.filter(c=>c!==s):[...l,s])},F=()=>{p.length===r.length?h([]):h(r.map(s=>s.id))},R=async s=>{if(confirm("Tem certeza que deseja excluir este protocolo?"))try{await f.excluirProtocolo(s),m("Protocolo excluído com sucesso"),j()}catch(l){console.error("Erro ao excluir protocolo:",l),m("Erro ao excluir protocolo")}},D=async()=>{if(confirm(`Tem certeza que deseja excluir ${p.length} protocolos?`))try{await Promise.all(p.map(s=>f.excluirProtocolo(s))),m(`${p.length} protocolos excluídos com sucesso`),h([]),j()}catch(s){console.error("Erro ao excluir protocolos:",s),m("Erro ao excluir protocolos")}},_=s=>({PROTOCOLADO:"bg-blue-100 text-blue-800",EM_TRAMITACAO:"bg-yellow-100 text-yellow-800",PENDENTE:"bg-orange-100 text-orange-800",CONCLUIDO:"bg-green-100 text-green-800",CANCELADO:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",L=s=>({BAIXA:"bg-gray-100 text-gray-800",NORMAL:"bg-blue-100 text-blue-800",ALTA:"bg-orange-100 text-orange-800",URGENTE:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Protocolos"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie todos os protocolos do sistema"})]}),e.jsxs(N,{to:"/protocolo/novo",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Novo Protocolo"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.total})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Em Tramitação"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.filter(s=>s.status==="EM_TRAMITACAO").length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Concluídos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.filter(s=>s.status==="CONCLUIDO").length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pendentes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.filter(s=>s.status==="PENDENTE").length})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("form",{onSubmit:S,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:d.search,onChange:s=>g("search",s.target.value),placeholder:"Buscar por número, assunto...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:d.tipo,onChange:s=>g("tipo",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),Array.isArray(v)&&v.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:d.status,onChange:s=>g("status",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),Array.isArray(P)&&P.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prioridade"}),e.jsxs("select",{value:d.prioridade,onChange:s=>g("prioridade",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"BAIXA",children:"Baixa"}),e.jsx("option",{value:"NORMAL",children:"Normal"}),e.jsx("option",{value:"ALTA",children:"Alta"}),e.jsx("option",{value:"URGENTE",children:"Urgente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Início"}),e.jsx("input",{type:"date",value:d.data_inicio,onChange:s=>g("data_inicio",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:d.data_fim,onChange:s=>g("data_fim",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{type:"submit",className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(G,{className:"w-5 h-5 inline mr-2"}),"Filtrar"]})})]})})]}),p.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-blue-800",children:[p.length," protocolo(s) selecionado(s)"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:D,className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:[e.jsx(T,{className:"w-4 h-4 inline mr-1"}),"Excluir"]}),e.jsx("button",{onClick:()=>h([]),className:"px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Cancelar"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[t?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(I,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando protocolos..."})]}):r.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(E,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum protocolo encontrado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:v.length===0&&P.length===0?"Erro ao carregar dados. Verifique sua conexão ou faça login novamente.":"Não há protocolos que correspondam aos filtros aplicados."}),e.jsxs(N,{to:"/protocolo/novo",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Criar Protocolo"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:p.length===r.length&&r.length>0,onChange:F,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assunto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prioridade"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Responsável"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(s=>{var l,c,y;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:p.includes(s.id),onChange:()=>k(s.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.numero})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:s.assunto}),e.jsxs("div",{className:"text-sm text-gray-500",children:[(l=s.descricao)==null?void 0:l.substring(0,50),"..."]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:(c=s.tipo_protocolo)==null?void 0:c.nome})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${_(s.status)}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${L(s.prioridade)}`,children:s.prioridade})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(s.data_abertura).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((y=s.responsavel_atual)==null?void 0:y.username)||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(N,{to:`/protocolo/${s.id}`,className:"text-blue-600 hover:text-blue-900",title:"Visualizar",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsx(N,{to:`/protocolo/${s.id}/editar`,className:"text-green-600 hover:text-green-900",title:"Editar",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>R(s.id),className:"text-red-600 hover:text-red-900",title:"Excluir",children:e.jsx(T,{className:"w-5 h-5"})})]})})]},s.id)})})]})}),n.total_pages>1&&e.jsx("div",{className:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>b(n.page-1),disabled:n.page===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Anterior"}),e.jsx("button",{onClick:()=>b(n.page+1),disabled:n.page===n.total_pages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Próxima"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Mostrando ",e.jsx("span",{className:"font-medium",children:(n.page-1)*n.page_size+1})," a"," ",e.jsx("span",{className:"font-medium",children:Math.min(n.page*n.page_size,n.total)})," ","de ",e.jsx("span",{className:"font-medium",children:n.total})," resultados"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e.jsx("button",{onClick:()=>b(n.page-1),disabled:n.page===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Anterior"}),Array.from({length:n.total_pages},(s,l)=>l+1).map(s=>e.jsx("button",{onClick:()=>b(s),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${s===n.page?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:s},s)),e.jsx("button",{onClick:()=>b(n.page+1),disabled:n.page===n.total_pages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Próxima"})]})})]})]})})]})]})};export{ce as default};
