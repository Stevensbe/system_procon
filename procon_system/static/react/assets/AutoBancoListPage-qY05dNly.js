import{j as e,l as p}from"./main-CRMJS0Wv.js";import{r as l,L as d}from"./router-Cgdj9vyr.js";import"./vendor-Csw2ODfV.js";import"./icons-qiKTog5F.js";function w(){const[a,i]=l.useState(null),[t,c]=l.useState(1),[f,m]=l.useState(!0),[u,x]=l.useState(""),[o,g]=l.useState({});l.useEffect(()=>{(async()=>{m(!0),x("");try{console.log(`🔄 Carregando autos da página ${t}...`);const s=await p(t,o);console.log("✅ Dados recebidos:",s),s&&s.results&&Array.isArray(s.results)?(i(s),console.log(`📊 ${s.results.length} autos carregados de ${s.count} total`)):(console.warn("⚠️ Estrutura inesperada, usando fallback:",s),i({results:[],count:0,next:null,previous:null,current_page:t,total_pages:0,debug_data:s}),x("Dados recebidos em formato inesperado"))}catch(s){console.error("❌ Erro ao carregar autos:",s),x(s.message||"Erro ao carregar autos de banco."),i({results:[],count:0,next:null,previous:null,current_page:t,total_pages:0})}finally{m(!1)}})()},[t,o]);const b=async()=>{console.log("🔍 Executando debug da API...");try{const r=await p(1,{});console.log("📋 Resultado do debug:",r)}catch(r){console.error("❌ Erro no debug:",r)}};if(f)return e.jsx("div",{className:"flex justify-center items-center p-8 min-h-64 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 dark:border-blue-400"}),e.jsx("div",{className:"text-lg text-gray-600 dark:text-gray-300 transition-colors duration-300",children:"Carregando autos de banco..."}),e.jsxs("div",{className:"text-sm text-gray-400 dark:text-gray-500 transition-colors duration-300",children:["Página ",t]})]})});if(u)return e.jsx("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-200 px-6 py-4 rounded-lg transition-colors duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Erro ao carregar dados"}),e.jsx("p",{className:"mt-2",children:u}),e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("strong",{children:"Página solicitada:"})," ",t,e.jsx("br",{}),e.jsx("strong",{children:"Filtros aplicados:"})," ",JSON.stringify(o)]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"🔄 Recarregar"}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors text-sm",children:"🔍 Debug API"})]})]}),(a==null?void 0:a.debug_data)&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:"📊 Dados recebidos (Debug)"}),e.jsx("pre",{className:"mt-2 p-3 bg-red-50 rounded text-xs overflow-auto max-h-40",children:JSON.stringify(a.debug_data,null,2)})]})]})});if(!a||!a.results)return e.jsx("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900/20 border border-yellow-400 dark:border-yellow-800 text-yellow-700 dark:text-yellow-200 px-6 py-4 rounded-lg transition-colors duration-300",children:[e.jsx("h3",{className:"font-bold",children:"Nenhum dado disponível"}),e.jsx("p",{className:"mt-2",children:"Não foi possível carregar os dados dos autos de banco."}),e.jsx("button",{onClick:b,className:"mt-3 px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors",children:"🔍 Diagnosticar Problema"})]})});const h=a.results;return e.jsxs("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white transition-colors duration-300",children:"Autos de Constatação - Bancos"}),e.jsx("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300 transition-colors duration-300",children:a.count>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:a.count})," auto",a.count!==1?"s":""," encontrado",a.count!==1?"s":"",a.total_pages>1&&e.jsxs("span",{className:"ml-2",children:["• Página ",a.current_page||t," de ",a.total_pages]})]}):"Nenhum auto encontrado"})]}),e.jsxs("div",{className:"flex gap-3",children:[!1,e.jsx(d,{to:"/fiscalizacao/bancos/novo",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"➕ Novo Auto"})]})]}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-[#1a1d21] rounded-lg border border-gray-200 dark:border-gray-700 transition-colors duration-300",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 transition-colors duration-300",children:"Município:"}),e.jsx("input",{type:"text",placeholder:"Filtrar por município",className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors duration-300",onChange:r=>{const s={...o};r.target.value?s.municipio=r.target.value:delete s.municipio,g(s)}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Com irregularidades:"}),e.jsxs("select",{className:"px-3 py-1 border border-gray-300 rounded text-sm",onChange:r=>{const s={...o};r.target.value!==""?s.tem_irregularidades=r.target.value:delete s.tem_irregularidades,g(s)},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"true",children:"Com irregularidades"}),e.jsx("option",{value:"false",children:"Sem irregularidades"})]})]}),Object.keys(o).length>0&&e.jsx("button",{onClick:()=>g({}),className:"px-3 py-1 bg-red-100 text-red-700 rounded text-sm hover:bg-red-200 transition-colors",children:"✖️ Limpar filtros"})]})}),h.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🏦"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"Nenhum auto de banco encontrado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:Object.keys(o).length>0?"Nenhum auto corresponde aos filtros aplicados.":"Ainda não há autos de banco cadastrados."}),e.jsx(d,{to:"/fiscalizacao/bancos/novo",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"➕ Criar Primeiro Auto"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Número"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Razão Social"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Município"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Data"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Ações"})]})}),e.jsx("tbody",{children:h.map(r=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-sm font-mono",children:r.numero||`AUTO-${r.id}`})}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.razao_social||"N/A"}),r.nome_fantasia&&e.jsx("div",{className:"text-sm text-gray-500",children:r.nome_fantasia})]}),e.jsx("td",{className:"p-4 text-gray-700",children:r.municipio||"N/A"}),e.jsx("td",{className:"p-4 text-gray-700",children:r.data_fiscalizacao?new Date(r.data_fiscalizacao+"T00:00:00").toLocaleDateString("pt-BR"):"Data não informada"}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.tem_irregularidades?"bg-red-100 text-red-800 border border-red-200":"bg-green-100 text-green-800 border border-green-200"}`,children:r.tem_irregularidades?"⚠️ Com Irregularidades":"✅ Conforme"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{to:`/fiscalizacao/bancos/${r.id}`,className:"text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors",children:"👁️ Ver"}),e.jsx(d,{to:`/fiscalizacao/bancos/${r.id}/editar`,className:"text-green-600 hover:text-green-800 font-medium text-sm transition-colors",children:"✏️ Editar"})]})})]},r.id))})]})})}),a.total_pages>1&&e.jsxs("div",{className:"flex justify-center items-center gap-4 mt-8",children:[e.jsx("button",{onClick:()=>c(t-1),disabled:!a.previous,className:"px-4 py-2 bg-gray-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:"⬅️ Anterior"}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:Math.min(5,a.total_pages)},(r,s)=>{const n=t<=3?s+1:t-2+s;return n>a.total_pages?null:e.jsx("button",{onClick:()=>c(n),className:`px-3 py-2 rounded transition-colors ${n===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:n},n)})}),e.jsx("button",{onClick:()=>c(t+1),disabled:!a.next,className:"px-4 py-2 bg-gray-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:"Próxima ➡️"})]}),!1]})}export{w as default};
