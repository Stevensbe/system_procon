import{j as s,F as t}from"./main-CRMJS0Wv.js";import{R as b,r as p}from"./router-Cgdj9vyr.js";import{C as N,a as S,b as C,c as $}from"./Card-Dmmsm_ua.js";import{B as m}from"./Button-D8n0E1pr.js";import{c as f}from"./cn-CcuJXRMQ.js";import{b as R,c as k,P as J,F as O,S as q,E as A,d as H,T as G}from"./icons-qiKTog5F.js";import"./vendor-Csw2ODfV.js";import"./charts-mbb-U41H.js";const P=b.forwardRef(({className:c,type:r,...e},o)=>s.jsx("input",{type:r,className:f("flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",c),ref:o,...e}));P.displayName="Input";const u=b.forwardRef(({className:c,...r},e)=>s.jsx("label",{ref:e,className:f("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",c),...r}));u.displayName="Label";const x=b.forwardRef(({className:c,children:r,...e},o)=>s.jsx("select",{className:f("flex h-10 w-full items-center justify-between rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",c),ref:o,...e,children:r}));x.displayName="Select";const w=({children:c,...r})=>s.jsx("div",{...r,children:c}),i=b.forwardRef(({className:c,children:r,...e},o)=>s.jsx("option",{ref:o,className:f("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100",c),...e,children:r}));i.displayName="SelectItem";const y=x,v=({placeholder:c,children:r,...e})=>s.jsx("span",{...e,children:r||c});class K{async listarEmpresas(r={}){try{const e=new URLSearchParams;return r.search&&e.append("search",r.search),r.situacao&&e.append("situacao",r.situacao),r.porte&&e.append("porte",r.porte),r.segmento&&e.append("segmento",r.segmento),r.cidade&&e.append("cidade",r.cidade),r.classificacao_risco&&e.append("classificacao_risco",r.classificacao_risco),r.page&&e.append("page",r.page),r.page_size&&e.append("page_size",r.page_size),(await t.get(`/empresas/?${e.toString()}`)).data}catch(e){throw console.error("Erro ao listar empresas:",e),e}}async obterEmpresa(r){try{return(await t.get(`/empresas/${r}/`)).data}catch(e){throw console.error("Erro ao obter empresa:",e),e}}async criarEmpresa(r){try{return(await t.post("/empresas/",r)).data}catch(e){throw console.error("Erro ao criar empresa:",e),e}}async atualizarEmpresa(r,e){try{return(await t.put(`/empresas/${r}/`,e)).data}catch(o){throw console.error("Erro ao atualizar empresa:",o),o}}async excluirEmpresa(r){try{return await t.delete(`/empresas/${r}/`),!0}catch(e){throw console.error("Erro ao excluir empresa:",e),e}}async listarResponsaveis(r){try{return(await t.get(`/empresas/${r}/responsaveis/`)).data}catch(e){throw console.error("Erro ao listar responsáveis:",e),e}}async adicionarResponsavel(r,e){try{return(await t.post(`/empresas/${r}/responsaveis/`,e)).data}catch(o){throw console.error("Erro ao adicionar responsável:",o),o}}async atualizarResponsavel(r,e,o){try{return(await t.put(`/empresas/${r}/responsaveis/${e}/`,o)).data}catch(n){throw console.error("Erro ao atualizar responsável:",n),n}}async removerResponsavel(r,e){try{return await t.delete(`/empresas/${r}/responsaveis/${e}/`),!0}catch(o){throw console.error("Erro ao remover responsável:",o),o}}async listarDocumentos(r){try{return(await t.get(`/empresas/${r}/documentos/`)).data}catch(e){throw console.error("Erro ao listar documentos:",e),e}}async uploadDocumento(r,e,o){try{const n=new FormData;return n.append("arquivo",e),n.append("tipo",o),(await t.post(`/empresas/${r}/documentos/`,n,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(n){throw console.error("Erro ao fazer upload do documento:",n),n}}async downloadDocumento(r,e){try{return(await t.get(`/empresas/${r}/documentos/${e}/download/`,{responseType:"blob"})).data}catch(o){throw console.error("Erro ao baixar documento:",o),o}}async excluirDocumento(r,e){try{return await t.delete(`/empresas/${r}/documentos/${e}/`),!0}catch(o){throw console.error("Erro ao excluir documento:",o),o}}async obterHistorico(r){try{return(await t.get(`/empresas/${r}/historico/`)).data}catch(e){throw console.error("Erro ao obter histórico:",e),e}}async obterEstatisticas(r){try{return(await t.get(`/empresas/${r}/estatisticas/`)).data}catch(e){throw console.error("Erro ao obter estatísticas:",e),e}}async consultarEmpresaPublica(r){try{return(await t.get(`/consulta-publica/empresas/${r}/`)).data}catch(e){throw console.error("Erro ao consultar empresa pública:",e),e}}async buscarEmpresasPublicas(r={}){try{const e=new URLSearchParams;return r.search&&e.append("search",r.search),r.situacao&&e.append("situacao",r.situacao),r.cidade&&e.append("cidade",r.cidade),r.segmento&&e.append("segmento",r.segmento),(await t.get(`/consulta-publica/empresas/?${e.toString()}`)).data}catch(e){throw console.error("Erro ao buscar empresas públicas:",e),e}}async obterPortes(){try{return(await t.get("/empresas/portes/")).data}catch(r){throw console.error("Erro ao obter portes:",r),r}}async obterSegmentos(){try{return(await t.get("/empresas/segmentos/")).data}catch(r){throw console.error("Erro ao obter segmentos:",r),r}}async obterCidades(){try{return(await t.get("/empresas/cidades/")).data}catch(r){throw console.error("Erro ao obter cidades:",r),r}}async validarCNPJ(r){try{return(await t.post("/empresas/validar-cnpj/",{cnpj:r})).data}catch(e){throw console.error("Erro ao validar CNPJ:",e),e}}async gerarRelatorioEmpresas(r={}){try{return(await t.post("/empresas/relatorio/",r)).data}catch(e){throw console.error("Erro ao gerar relatório de empresas:",e),e}}async exportarEmpresas(r="xlsx",e={}){try{const o=new URLSearchParams;return o.append("formato",r),Object.keys(e).forEach(l=>{e[l]&&o.append(l,e[l])}),(await t.get(`/empresas/exportar/?${o.toString()}`,{responseType:"blob"})).data}catch(o){throw console.error("Erro ao exportar empresas:",o),o}}}const j=new K,se=()=>{const[c,r]=p.useState([]),[e,o]=p.useState(!1),[n,l]=p.useState({search:"",situacao:"",porte:"",segmento:"",cidade:""}),[F,T]=p.useState([]),[z,D]=p.useState([]),[L,_]=p.useState([]);p.useEffect(()=>{E(),U()},[]);const E=async()=>{o(!0);try{const a=await j.listarEmpresas(n);r(a.results||a)}catch(a){console.error("Erro ao carregar empresas:",a)}finally{o(!1)}},U=async()=>{try{const[a,h,d]=await Promise.all([j.obterPortes(),j.obterSegmentos(),j.obterCidades()]);T(a),D(h),_(d)}catch(a){console.error("Erro ao carregar dados auxiliares:",a)}},g=(a,h)=>{l(d=>({...d,[a]:h}))},B=()=>{E()},I=()=>{l({search:"",situacao:"",porte:"",segmento:"",cidade:""})},V=async()=>{try{const a=await j.exportarEmpresas("xlsx",n),h=window.URL.createObjectURL(a),d=document.createElement("a");d.href=h,d.download="empresas.xlsx",d.click(),window.URL.revokeObjectURL(h)}catch(a){console.error("Erro ao exportar empresas:",a)}};return s.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[s.jsx(R,{className:"h-8 w-8 text-blue-600"}),"Empresas"]}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Gerencie o cadastro de empresas"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(m,{onClick:V,variant:"outline",children:[s.jsx(k,{className:"h-4 w-4 mr-2"}),"Exportar"]}),s.jsxs(m,{children:[s.jsx(J,{className:"h-4 w-4 mr-2"}),"Nova Empresa"]})]})]}),s.jsxs(N,{children:[s.jsx(S,{children:s.jsxs(C,{className:"flex items-center gap-2",children:[s.jsx(O,{className:"h-5 w-5"}),"Filtros"]})}),s.jsx($,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[s.jsxs("div",{children:[s.jsx(u,{htmlFor:"search",children:"Buscar"}),s.jsx(P,{placeholder:"Nome, CNPJ...",value:n.search,onChange:a=>g("search",a.target.value)})]}),s.jsxs("div",{children:[s.jsx(u,{htmlFor:"situacao",children:"Situação"}),s.jsxs(x,{value:n.situacao,onValueChange:a=>g("situacao",a),children:[s.jsx(y,{children:s.jsx(v,{placeholder:"Todas"})}),s.jsxs(w,{children:[s.jsx(i,{value:"",children:"Todas"}),s.jsx(i,{value:"ativa",children:"Ativa"}),s.jsx(i,{value:"suspensa",children:"Suspensa"}),s.jsx(i,{value:"inativa",children:"Inativa"})]})]})]}),s.jsxs("div",{children:[s.jsx(u,{htmlFor:"porte",children:"Porte"}),s.jsxs(x,{value:n.porte,onValueChange:a=>g("porte",a),children:[s.jsx(y,{children:s.jsx(v,{placeholder:"Todos"})}),s.jsxs(w,{children:[s.jsx(i,{value:"",children:"Todos"}),F.map(a=>s.jsx(i,{value:a.id,children:a.nome},a.id))]})]})]}),s.jsxs("div",{children:[s.jsx(u,{htmlFor:"segmento",children:"Segmento"}),s.jsxs(x,{value:n.segmento,onValueChange:a=>g("segmento",a),children:[s.jsx(y,{children:s.jsx(v,{placeholder:"Todos"})}),s.jsxs(w,{children:[s.jsx(i,{value:"",children:"Todos"}),z.map(a=>s.jsx(i,{value:a.id,children:a.nome},a.id))]})]})]}),s.jsxs("div",{children:[s.jsx(u,{htmlFor:"cidade",children:"Cidade"}),s.jsxs(x,{value:n.cidade,onValueChange:a=>g("cidade",a),children:[s.jsx(y,{children:s.jsx(v,{placeholder:"Todas"})}),s.jsxs(w,{children:[s.jsx(i,{value:"",children:"Todas"}),L.map(a=>s.jsx(i,{value:a,children:a},a))]})]})]}),s.jsxs("div",{className:"flex items-end gap-2",children:[s.jsxs(m,{onClick:B,className:"flex-1",children:[s.jsx(q,{className:"h-4 w-4 mr-2"}),"Buscar"]}),s.jsx(m,{onClick:I,variant:"outline",children:"Limpar"})]})]})})]}),s.jsxs(N,{children:[s.jsx(S,{children:s.jsx(C,{children:"Empresas Cadastradas"})}),s.jsx($,{children:e?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando empresas..."})]}):c.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(R,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Nenhuma empresa encontrada"})]}):s.jsx("div",{className:"space-y-4",children:c.map(a=>s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:a.razao_social}),s.jsxs("p",{className:"text-sm text-gray-600",children:["CNPJ: ",a.cnpj," |",a.nome_fantasia&&` Fantasia: ${a.nome_fantasia} |`,"Cidade: ",a.cidade," | Situação: ",s.jsx("span",{className:`font-medium ${a.situacao==="ativa"?"text-green-600":a.situacao==="suspensa"?"text-yellow-600":"text-red-600"}`,children:a.situacao})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(m,{size:"sm",variant:"outline",children:s.jsx(A,{className:"h-4 w-4"})}),s.jsx(m,{size:"sm",variant:"outline",children:s.jsx(H,{className:"h-4 w-4"})}),s.jsx(m,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:s.jsx(G,{className:"h-4 w-4"})})]})]},a.id))})})]})]})};export{se as default};
