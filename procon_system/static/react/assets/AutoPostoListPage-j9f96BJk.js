import{j as e,n as b}from"./main-CRMJS0Wv.js";import{r as i,L as d}from"./router-Cgdj9vyr.js";import"./vendor-Csw2ODfV.js";import"./icons-qiKTog5F.js";function A(){const[r,l]=i.useState(null),[a,c]=i.useState(1),[f,m]=i.useState(!0),[u,x]=i.useState(""),[n,g]=i.useState({});i.useEffect(()=>{(async()=>{m(!0),x("");try{console.log(`🔄 Carregando autos de postos da página ${a}...`);const s=await b(a,n);console.log("✅ Dados recebidos:",s),s&&s.results&&Array.isArray(s.results)?(l(s),console.log(`📊 ${s.results.length} autos carregados de ${s.count} total`)):Array.isArray(s)?(l({results:s,count:s.length,next:null,previous:null,current_page:a,total_pages:Math.ceil(s.length/10)}),console.log(`📊 ${s.length} autos carregados (array direto)`)):(console.warn("⚠️ Estrutura inesperada, usando fallback:",s),l({results:[],count:0,next:null,previous:null,current_page:a,total_pages:0,debug_data:s}),x("Dados recebidos em formato inesperado"))}catch(s){console.error("❌ Erro ao carregar autos:",s),x(s.message||"Erro ao carregar autos de posto."),l({results:[],count:0,next:null,previous:null,current_page:a,total_pages:0})}finally{m(!1)}})()},[a,n]);const h=async()=>{console.log("🔍 Executando debug da API...");try{const t=await b(1,{});console.log("📋 Resultado do debug:",t)}catch(t){console.error("❌ Erro no debug:",t)}},y=t=>[t.gasolina_comum_totem,t.gasolina_aditivada_totem,t.etanol_totem,t.diesel_comum_totem,t.diesel_s10_totem,t.gnv_totem].filter(o=>o&&parseFloat(o)>0).length,j=t=>{const s=t.notas_fiscais_apos?t.notas_fiscais_apos.length:0,o=t.notas_fiscais_antes?t.notas_fiscais_antes.length:0;return s+o},N=t=>{const s=t.cupons_fiscais_apos?t.cupons_fiscais_apos.length:0,o=t.cupons_fiscais_antes?t.cupons_fiscais_antes.length:0;return s+o};if(f)return e.jsx("div",{className:"flex justify-center items-center p-8 min-h-64 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 dark:border-orange-400"}),e.jsx("div",{className:"text-lg text-gray-600 dark:text-gray-300 transition-colors duration-300",children:"Carregando autos de postos..."}),e.jsxs("div",{className:"text-sm text-gray-400 dark:text-gray-500 transition-colors duration-300",children:["Página ",a]})]})});if(u)return e.jsx("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-200 px-6 py-4 rounded-lg transition-colors duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Erro ao carregar dados"}),e.jsx("p",{className:"mt-2",children:u}),e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("strong",{children:"Página solicitada:"})," ",a,e.jsx("br",{}),e.jsx("strong",{children:"Filtros aplicados:"})," ",JSON.stringify(n)]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"🔄 Recarregar"}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors text-sm",children:"🔍 Debug API"})]})]}),(r==null?void 0:r.debug_data)&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:"📊 Dados recebidos (Debug)"}),e.jsx("pre",{className:"mt-2 p-3 bg-red-50 rounded text-xs overflow-auto max-h-40",children:JSON.stringify(r.debug_data,null,2)})]})]})});if(!r||!r.results)return e.jsx("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900/20 border border-yellow-400 dark:border-yellow-800 text-yellow-700 dark:text-yellow-200 px-6 py-4 rounded-lg transition-colors duration-300",children:[e.jsx("h3",{className:"font-bold",children:"Nenhum dado disponível"}),e.jsx("p",{className:"mt-2",children:"Não foi possível carregar os dados dos autos de posto."}),e.jsx("button",{onClick:h,className:"mt-3 px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors",children:"🔍 Diagnosticar Problema"})]})});const p=r.results;return e.jsxs("div",{className:"p-8 bg-gray-50 dark:bg-[#0c0f12] transition-colors duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white transition-colors duration-300",children:"Autos de Constatação - Postos de Combustível"}),e.jsx("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300 transition-colors duration-300",children:r.count>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:r.count})," auto",r.count!==1?"s":""," encontrado",r.count!==1?"s":"",r.total_pages>1&&e.jsxs("span",{className:"ml-2",children:["• Página ",r.current_page||a," de ",r.total_pages]})]}):"Nenhum auto encontrado"})]}),e.jsxs("div",{className:"flex gap-3",children:[!1,e.jsx(d,{to:"/fiscalizacao/postos/novo",className:"px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-medium",children:"➕ Novo Auto"})]})]}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-[#1a1d21] rounded-lg border border-gray-200 dark:border-gray-700 transition-colors duration-300",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 transition-colors duration-300",children:"Município:"}),e.jsx("input",{type:"text",placeholder:"Filtrar por município",className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors duration-300",onChange:t=>{const s={...n};t.target.value?s.municipio=t.target.value:delete s.municipio,g(s)}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Documentos:"}),e.jsxs("select",{className:"px-3 py-1 border border-gray-300 rounded text-sm",onChange:t=>{const s={...n};t.target.value!==""?s.documentos_apresentados=t.target.value:delete s.documentos_apresentados,g(s)},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"true",children:"Apresentados"}),e.jsx("option",{value:"false",children:"Pendentes"})]})]}),Object.keys(n).length>0&&e.jsx("button",{onClick:()=>g({}),className:"px-3 py-1 bg-red-100 text-red-700 rounded text-sm hover:bg-red-200 transition-colors",children:"✖️ Limpar filtros"})]})}),p.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-[#1a1d21] rounded-lg shadow border-2 border-dashed border-gray-300 dark:border-gray-600 transition-colors duration-300",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⛽"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white mb-2 transition-colors duration-300",children:"Nenhum auto de posto encontrado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 transition-colors duration-300",children:Object.keys(n).length>0?"Nenhum auto corresponde aos filtros aplicados.":"Ainda não há autos de posto cadastrados."}),e.jsx(d,{to:"/fiscalizacao/postos/novo",className:"inline-flex items-center px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-medium",children:"➕ Criar Primeiro Auto"})]}):e.jsx("div",{className:"bg-white dark:bg-[#1a1d21] rounded-lg shadow overflow-hidden transition-colors duration-300",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Número"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Estabelecimento"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"CNPJ"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Município"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Data"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Combustíveis"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Documentos"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900 dark:text-white transition-colors duration-300",children:"Ações"})]})}),e.jsx("tbody",{children:p.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsx("code",{className:"bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded text-sm font-mono text-gray-900 dark:text-white transition-colors duration-300",children:t.numero||`POSTO-${t.id}`})}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white transition-colors duration-300",children:t.razao_social||"N/A"}),t.nome_fantasia&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300",children:t.nome_fantasia})]}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300 transition-colors duration-300",children:t.cnpj||"N/A"}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300 transition-colors duration-300",children:t.municipio||"N/A"}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300 transition-colors duration-300",children:t.data_fiscalizacao?new Date(t.data_fiscalizacao+"T00:00:00").toLocaleDateString("pt-BR"):"Data não informada"}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200",children:["⛽ ",y(t)," tipo(s)"]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[t.documentos_apresentados?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:"✅ Apresentados"}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-200",children:["⏰ Pendentes (",t.prazo_apresentacao||24,"h)"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["NF: ",j(t)," | Cupons: ",N(t)]})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{to:`/fiscalizacao/postos/${t.id}`,className:"text-orange-600 hover:text-orange-800 font-medium text-sm transition-colors",children:"👁️ Ver"}),e.jsx(d,{to:`/fiscalizacao/postos/${t.id}/editar`,className:"text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors",children:"✏️ Editar"})]})})]},t.id))})]})})}),r.total_pages>1&&e.jsxs("div",{className:"flex justify-center items-center gap-4 mt-8",children:[e.jsx("button",{onClick:()=>c(a-1),disabled:!r.previous,className:"px-4 py-2 bg-gray-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:"⬅️ Anterior"}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:Math.min(5,r.total_pages)},(t,s)=>{const o=a<=3?s+1:a-2+s;return o>r.total_pages?null:e.jsx("button",{onClick:()=>c(o),className:`px-3 py-2 rounded transition-colors ${o===a?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:o},o)})}),e.jsx("button",{onClick:()=>c(a+1),disabled:!r.next,className:"px-4 py-2 bg-gray-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors flex items-center gap-2",children:"Próxima ➡️"})]}),!1]})}export{A as default};
