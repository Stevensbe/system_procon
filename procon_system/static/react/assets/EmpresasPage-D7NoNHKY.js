import{b as t,j as e}from"./main-QkSqPps8.js";import{r as d}from"./router-C15yhWin.js";import{C as b,a as N,b as f,c as S}from"./Card-BFooshdr.js";import{B as p}from"./Button-BI_T66hn.js";import{L as u,I as B,S as j,a as g,b as w,c as y,d as n}from"./select-NJUiuWrx.js";import{B as C,e as V,P as k,f as I,g as J,E as O,h as q,i as A}from"./icons-C8WIGuh4.js";import"./vendor-Csw2ODfV.js";import"./cn-CqYPwb_p.js";import"./charts-BhhE3E4a.js";class H{async listarEmpresas(s={}){try{const r=new URLSearchParams;return s.search&&r.append("search",s.search),s.situacao&&r.append("situacao",s.situacao),s.porte&&r.append("porte",s.porte),s.segmento&&r.append("segmento",s.segmento),s.cidade&&r.append("cidade",s.cidade),s.classificacao_risco&&r.append("classificacao_risco",s.classificacao_risco),s.page&&r.append("page",s.page),s.page_size&&r.append("page_size",s.page_size),(await t.get(`/empresas/?${r.toString()}`)).data}catch(r){throw console.error("Erro ao listar empresas:",r),r}}async obterEmpresa(s){try{return(await t.get(`/empresas/${s}/`)).data}catch(r){throw console.error("Erro ao obter empresa:",r),r}}async criarEmpresa(s){try{return(await t.post("/empresas/",s)).data}catch(r){throw console.error("Erro ao criar empresa:",r),r}}async atualizarEmpresa(s,r){try{return(await t.put(`/empresas/${s}/`,r)).data}catch(o){throw console.error("Erro ao atualizar empresa:",o),o}}async excluirEmpresa(s){try{return await t.delete(`/empresas/${s}/`),!0}catch(r){throw console.error("Erro ao excluir empresa:",r),r}}async listarResponsaveis(s){try{return(await t.get(`/empresas/${s}/responsaveis/`)).data}catch(r){throw console.error("Erro ao listar responsáveis:",r),r}}async adicionarResponsavel(s,r){try{return(await t.post(`/empresas/${s}/responsaveis/`,r)).data}catch(o){throw console.error("Erro ao adicionar responsável:",o),o}}async atualizarResponsavel(s,r,o){try{return(await t.put(`/empresas/${s}/responsaveis/${r}/`,o)).data}catch(c){throw console.error("Erro ao atualizar responsável:",c),c}}async removerResponsavel(s,r){try{return await t.delete(`/empresas/${s}/responsaveis/${r}/`),!0}catch(o){throw console.error("Erro ao remover responsável:",o),o}}async listarDocumentos(s){try{return(await t.get(`/empresas/${s}/documentos/`)).data}catch(r){throw console.error("Erro ao listar documentos:",r),r}}async uploadDocumento(s,r,o){try{const c=new FormData;return c.append("arquivo",r),c.append("tipo",o),(await t.post(`/empresas/${s}/documentos/`,c,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(c){throw console.error("Erro ao fazer upload do documento:",c),c}}async downloadDocumento(s,r){try{return(await t.get(`/empresas/${s}/documentos/${r}/download/`,{responseType:"blob"})).data}catch(o){throw console.error("Erro ao baixar documento:",o),o}}async excluirDocumento(s,r){try{return await t.delete(`/empresas/${s}/documentos/${r}/`),!0}catch(o){throw console.error("Erro ao excluir documento:",o),o}}async obterHistorico(s){try{return(await t.get(`/empresas/${s}/historico/`)).data}catch(r){throw console.error("Erro ao obter histórico:",r),r}}async obterEstatisticas(s){try{return(await t.get(`/empresas/${s}/estatisticas/`)).data}catch(r){throw console.error("Erro ao obter estatísticas:",r),r}}async consultarEmpresaPublica(s){try{return(await t.get(`/consulta-publica/empresas/${s}/`)).data}catch(r){throw console.error("Erro ao consultar empresa pública:",r),r}}async buscarEmpresasPublicas(s={}){try{const r=new URLSearchParams;return s.search&&r.append("search",s.search),s.situacao&&r.append("situacao",s.situacao),s.cidade&&r.append("cidade",s.cidade),s.segmento&&r.append("segmento",s.segmento),(await t.get(`/consulta-publica/empresas/?${r.toString()}`)).data}catch(r){throw console.error("Erro ao buscar empresas públicas:",r),r}}async obterPortes(){try{return(await t.get("/empresas/portes/")).data}catch(s){throw console.error("Erro ao obter portes:",s),s}}async obterSegmentos(){try{return(await t.get("/empresas/segmentos/")).data}catch(s){throw console.error("Erro ao obter segmentos:",s),s}}async obterCidades(){try{return(await t.get("/empresas/cidades/")).data}catch(s){throw console.error("Erro ao obter cidades:",s),s}}async validarCNPJ(s){try{return(await t.post("/empresas/validar-cnpj/",{cnpj:s})).data}catch(r){throw console.error("Erro ao validar CNPJ:",r),r}}async gerarRelatorioEmpresas(s={}){try{return(await t.post("/empresas/relatorio/",s)).data}catch(r){throw console.error("Erro ao gerar relatório de empresas:",r),r}}async exportarEmpresas(s="xlsx",r={}){try{const o=new URLSearchParams;return o.append("formato",s),Object.keys(r).forEach(i=>{r[i]&&o.append(i,r[i])}),(await t.get(`/empresas/exportar/?${o.toString()}`,{responseType:"blob"})).data}catch(o){throw console.error("Erro ao exportar empresas:",o),o}}}const x=new H,re=()=>{const[v,s]=d.useState([]),[r,o]=d.useState(!1),[c,i]=d.useState({search:"",situacao:"",porte:"",segmento:"",cidade:""}),[$,P]=d.useState([]),[T,F]=d.useState([]),[R,z]=d.useState([]);d.useEffect(()=>{E(),D()},[]);const E=async()=>{o(!0);try{const a=await x.listarEmpresas(c);s(a.results||a)}catch(a){console.error("Erro ao carregar empresas:",a)}finally{o(!1)}},D=async()=>{try{const[a,m,l]=await Promise.all([x.obterPortes(),x.obterSegmentos(),x.obterCidades()]);P(a),F(m),z(l)}catch(a){console.error("Erro ao carregar dados auxiliares:",a)}},h=(a,m)=>{i(l=>({...l,[a]:m}))},L=()=>{E()},_=()=>{i({search:"",situacao:"",porte:"",segmento:"",cidade:""})},U=async()=>{try{const a=await x.exportarEmpresas("xlsx",c),m=window.URL.createObjectURL(a),l=document.createElement("a");l.href=m,l.download="empresas.xlsx",l.click(),window.URL.revokeObjectURL(m)}catch(a){console.error("Erro ao exportar empresas:",a)}};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(C,{className:"h-8 w-8 text-blue-600"}),"Empresas"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gerencie o cadastro de empresas"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:U,variant:"outline",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Exportar"]}),e.jsxs(p,{children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Nova Empresa"]})]})]}),e.jsxs(b,{children:[e.jsx(N,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Filtros"]})}),e.jsx(S,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"search",children:"Buscar"}),e.jsx(B,{placeholder:"Nome, CNPJ...",value:c.search,onChange:a=>h("search",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"situacao",children:"Situação"}),e.jsxs(j,{value:c.situacao,onValueChange:a=>h("situacao",a),children:[e.jsx(g,{children:e.jsx(w,{placeholder:"Todas"})}),e.jsxs(y,{children:[e.jsx(n,{value:"",children:"Todas"}),e.jsx(n,{value:"ativa",children:"Ativa"}),e.jsx(n,{value:"suspensa",children:"Suspensa"}),e.jsx(n,{value:"inativa",children:"Inativa"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"porte",children:"Porte"}),e.jsxs(j,{value:c.porte,onValueChange:a=>h("porte",a),children:[e.jsx(g,{children:e.jsx(w,{placeholder:"Todos"})}),e.jsxs(y,{children:[e.jsx(n,{value:"",children:"Todos"}),$.map(a=>e.jsx(n,{value:a.id,children:a.nome},a.id))]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"segmento",children:"Segmento"}),e.jsxs(j,{value:c.segmento,onValueChange:a=>h("segmento",a),children:[e.jsx(g,{children:e.jsx(w,{placeholder:"Todos"})}),e.jsxs(y,{children:[e.jsx(n,{value:"",children:"Todos"}),T.map(a=>e.jsx(n,{value:a.id,children:a.nome},a.id))]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"cidade",children:"Cidade"}),e.jsxs(j,{value:c.cidade,onValueChange:a=>h("cidade",a),children:[e.jsx(g,{children:e.jsx(w,{placeholder:"Todas"})}),e.jsxs(y,{children:[e.jsx(n,{value:"",children:"Todas"}),R.map(a=>e.jsx(n,{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs(p,{onClick:L,className:"flex-1",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Buscar"]}),e.jsx(p,{onClick:_,variant:"outline",children:"Limpar"})]})]})})]}),e.jsxs(b,{children:[e.jsx(N,{children:e.jsx(f,{children:"Empresas Cadastradas"})}),e.jsx(S,{children:r?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando empresas..."})]}):v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(C,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma empresa encontrada"})]}):e.jsx("div",{className:"space-y-4",children:v.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a.razao_social}),e.jsxs("p",{className:"text-sm text-gray-600",children:["CNPJ: ",a.cnpj," |",a.nome_fantasia&&` Fantasia: ${a.nome_fantasia} |`,"Cidade: ",a.cidade," | Situação: ",e.jsx("span",{className:`font-medium ${a.situacao==="ativa"?"text-green-600":a.situacao==="suspensa"?"text-yellow-600":"text-red-600"}`,children:a.situacao})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{size:"sm",variant:"outline",children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx(p,{size:"sm",variant:"outline",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx(p,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:e.jsx(A,{className:"h-4 w-4"})})]})]},a.id))})})]})]})};export{re as default};
