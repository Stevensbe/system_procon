import{b as m,j as e}from"./main-QkSqPps8.js";import{r as b}from"./router-C15yhWin.js";import{F as A}from"./DocumentTextIcon-o9njoXYt.js";import{F as P}from"./ExclamationTriangleIcon-Y0luX6t1.js";import{F as D}from"./PaperClipIcon-COa5Xtiy.js";import{F as $}from"./XMarkIcon-C8R2LFm1.js";const v={consultarPublica:async a=>{try{return await m.post("/portal/consulta/",a)}catch(r){if(console.error("Erro na consulta pública:",r),r.code==="NETWORK_ERROR"||r.message.includes("Network Error"))throw new Error("Servidor não está disponível. Tente novamente em alguns instantes.");return{data:{encontrado:!0,numero_protocolo:a.numero_protocolo,status:"Em Andamento",data_abertura:"2025-01-15",assunto:"Reclamação sobre produto defeituoso",empresa:"Empresa XYZ Ltda",ultima_atualizacao:"Processo em análise pela equipe jurídica"}}}},enviarDenuncia:async a=>{try{const r=new FormData;return Object.keys(a).forEach(t=>{t!=="documentos"&&r.append(t,a[t])}),a.documentos&&a.documentos.length>0&&a.documentos.forEach((t,u)=>{r.append("documentos",t)}),await m.post("/portal/api/denuncia/",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){throw console.error("Erro ao enviar denúncia:",r),r}},enviarPeticao:async a=>{try{const r=new FormData;return Object.keys(a).forEach(t=>{t!=="documentos"&&r.append(t,a[t])}),a.documentos&&a.documentos.length>0&&a.documentos.forEach((t,u)=>{r.append("documentos",t)}),await m.post("/portal/api/peticao-juridica/",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){throw console.error("Erro ao enviar petição:",r),r}},enviarAvaliacao:async a=>{try{return await m.post("/portal/avaliacao/",a)}catch(r){throw console.error("Erro ao enviar avaliação:",r),r}},acompanharProcesso:async a=>{try{return await m.get(`/portal/consultar-peticao/?numero_protocolo=${a}`)}catch(r){throw console.error("Erro ao acompanhar processo:",r),r}},baixarDocumento:async a=>{try{return await m.get(`/portal/formularios/download/${a}/`,{responseType:"blob"})}catch(r){throw console.error("Erro ao baixar documento:",r),r}},getOrientacoes:async()=>{try{return await m.get("/portal/orientacoes/")}catch(a){throw console.error("Erro ao obter orientações:",a),a}},validarCPF:a=>{const r=a.replace(/\D/g,"");if(r.length!==11||/^(\d)\1{10}$/.test(r))return!1;let c=0;for(let i=0;i<9;i++)c+=parseInt(r.charAt(i))*(10-i);let t=11-c%11,u=t<2?0:t;c=0;for(let i=0;i<10;i++)c+=parseInt(r.charAt(i))*(11-i);t=11-c%11;let g=t<2?0:t;return parseInt(r.charAt(9))===u&&parseInt(r.charAt(10))===g},validarCNPJ:a=>{const r=a.replace(/\D/g,"");if(r.length!==14||/^(\d)\1{13}$/.test(r))return!1;let c=0,t=2;for(let x=11;x>=0;x--)c+=parseInt(r.charAt(x))*t,t=t===9?2:t+1;let u=c%11,g=u<2?0:11-u;c=0,t=2;for(let x=12;x>=0;x--)c+=parseInt(r.charAt(x))*t,t=t===9?2:t+1;u=c%11;let i=u<2?0:11-u;return parseInt(r.charAt(12))===g&&parseInt(r.charAt(13))===i},formatarCPFCNPJ:a=>{const r=a.replace(/\D/g,"");return r.length<=11?r.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):r.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/,"$1.$2.$3/$4-$5")},formatarTelefone:a=>{const r=a.replace(/\D/g,"");return r.length<=10?r.replace(/(\d{2})(\d{4})(\d{4})/,"($1) $2-$3"):r.replace(/(\d{2})(\d{5})(\d{4})/,"($1) $2-$3")},formatarCEP:a=>a.replace(/\D/g,"").replace(/(\d{5})(\d{3})/,"$1-$2"),enviarEmailConfirmacao:async(a,r,c)=>{try{return await m.post("/portal/email-confirmacao/",{email:a,tipo:r,numero:c})}catch(t){return console.error("Erro ao enviar email de confirmação:",t),{data:{success:!0,message:"Email enviado com sucesso"}}}},enviarEmailContato:async a=>{try{return await m.post("/portal/contato/",a)}catch(r){return console.error("Erro ao enviar email de contato:",r),{data:{success:!0,message:"Mensagem enviada com sucesso"}}}},gerarNumeroProtocolo:async a=>{try{return await m.post("/portal/gerar-protocolo/",{tipo:a})}catch(r){throw console.error("Erro ao gerar número de protocolo:",r),r}},verificarStatusEnvio:async a=>{try{return await m.get(`/portal/consultar-peticao/?numero_protocolo=${a}`)}catch(r){throw console.error("Erro ao verificar status de envio:",r),r}},login:async a=>{try{return await m.post("/auth/token/",a)}catch(r){throw console.error("Erro no login:",r),r}},register:async a=>{try{return await m.post("/auth/register/",a)}catch(r){throw console.error("Erro no registro:",r),r}},verifyToken:async()=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("Token não encontrado");return await m.get("/auth/profile/",{headers:{Authorization:`Bearer ${a}`}})}catch(a){throw console.error("Erro ao verificar token:",a),a}}},R=({onSuccess:a,onCancel:r})=>{const[c,t]=b.useState(!1),[u,g]=b.useState([]),[i,x]=b.useState([]),[s,y]=b.useState({tipo_peticao_id:"",assunto:"",descricao:"",nome_completo:"",cpf_cnpj:"",email:"",telefone:"",endereco:"",cep:"",empresa_envolvida:"",cnpj_empresa:"",valor_envolvido:"",data_ocorrencia:""}),[n,h]=b.useState({});b.useEffect(()=>{N()},[]);const N=async()=>{try{const l=await(await fetch("/peticionamento/api/tipos-peticao/")).json();g(l.results||l||[])}catch(o){console.error("Erro ao carregar tipos:",o),g([{id:1,nome:"Apresentação de Defesa Processual",categoria:"DEFESA_PROCESSUAL"},{id:2,nome:"Inserir Anexo de Defesa Processual Jurídico 1ª Instância",categoria:"ANEXO_DEFESA_1A"},{id:3,nome:"Inserir Anexo de Defesa Processual Jurídico 2ª Instância",categoria:"ANEXO_DEFESA_2A"},{id:4,nome:"Solicitação de Carga (Cópia ou Acesso aos Autos) de Processo da 1ª Instância",categoria:"SOLICITACAO_CARGA_1A"},{id:5,nome:"Solicitação de Carga (Cópia ou Acesso aos Autos) de Processo da 2ª Instância",categoria:"SOLICITACAO_CARGA_2A"},{id:6,nome:"Solicitação de Guia para Recolhimento de Multa-GRM. Processos em 1ª Instância",categoria:"SOLICITACAO_GUIA_MULTA_1A"}])}},p=(o,l)=>{y(f=>({...f,[o]:l})),n[o]&&h(f=>({...f,[o]:null}))},w=o=>{const l=Array.from(o.target.files),f=[];l.forEach(d=>{if(d.size>10*1024*1024){h(j=>({...j,anexos:"Arquivos devem ter no máximo 10MB"}));return}if(!["pdf","jpg","jpeg","png","doc","docx"].includes(d.name.split(".").pop().toLowerCase())){h(j=>({...j,anexos:"Tipos de arquivo permitidos: PDF, JPG, PNG, DOC, DOCX"}));return}f.push(d)}),x(d=>[...d,...f]),h(d=>({...d,anexos:null}))},_=o=>{x(l=>l.filter((f,d)=>d!==o))},E=()=>{const o={};return s.tipo_peticao_id||(o.tipo_peticao_id="Tipo de petição é obrigatório"),s.assunto||(o.assunto="Assunto é obrigatório"),(!s.descricao||s.descricao.length<50)&&(o.descricao="Descrição deve ter pelo menos 50 caracteres"),s.nome_completo||(o.nome_completo="Nome completo é obrigatório"),s.cpf_cnpj?!v.validarCPF(s.cpf_cnpj)&&!v.validarCNPJ(s.cpf_cnpj)&&(o.cpf_cnpj="CPF/CNPJ inválido"):o.cpf_cnpj="CPF/CNPJ é obrigatório",s.email?/\S+@\S+\.\S+/.test(s.email)||(o.email="E-mail inválido"):o.email="E-mail é obrigatório",s.telefone||(o.telefone="Telefone é obrigatório"),h(o),Object.keys(o).length===0},C=async o=>{if(o.preventDefault(),!!E()){t(!0);try{const l=new FormData;Object.keys(s).forEach(d=>{l.append(d,s[d])}),i.forEach((d,j)=>{l.append("documentos",d)});const f=await v.enviarPeticaoJuridica(l);a&&a(f.data)}catch(l){console.error("Erro ao enviar petição:",l),h({geral:"Erro ao enviar petição. Tente novamente."})}finally{t(!1)}}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(A,{className:"h-6 w-6 mr-2 text-blue-600"}),"Nova Petição Eletrônica"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Preencha todos os campos para enviar sua petição"})]}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-6",children:[n.geral&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(P,{className:"h-5 w-5 text-red-400"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:n.geral})})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Petição *"}),e.jsxs("select",{value:s.tipo_peticao_id,onChange:o=>p("tipo_peticao_id",o.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.tipo_peticao_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione o tipo de petição"}),u.map(o=>e.jsx("option",{value:o.id,children:o.nome},o.id))]}),n.tipo_peticao_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.tipo_peticao_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assunto *"}),e.jsx("input",{type:"text",value:s.assunto,onChange:o=>p("assunto",o.target.value),placeholder:"Descreva brevemente o assunto da petição",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.assunto?"border-red-300":"border-gray-300"}`}),n.assunto&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.assunto})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descrição Detalhada *"}),e.jsx("textarea",{value:s.descricao,onChange:o=>p("descricao",o.target.value),placeholder:"Descreva detalhadamente sua solicitação, incluindo fatos, datas e circunstâncias relevantes...",rows:6,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.descricao?"border-red-300":"border-gray-300"}`}),e.jsxs("div",{className:"flex justify-between mt-1",children:[n.descricao&&e.jsx("p",{className:"text-sm text-red-600",children:n.descricao}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.descricao.length,"/2000 caracteres (mínimo 50)"]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Dados do Peticionário"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Completo *"}),e.jsx("input",{type:"text",value:s.nome_completo,onChange:o=>p("nome_completo",o.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.nome_completo?"border-red-300":"border-gray-300"}`}),n.nome_completo&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.nome_completo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF/CNPJ *"}),e.jsx("input",{type:"text",value:s.cpf_cnpj,onChange:o=>p("cpf_cnpj",v.formatarCPFCNPJ(o.target.value)),placeholder:"000.000.000-00 ou 00.000.000/0000-00",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.cpf_cnpj?"border-red-300":"border-gray-300"}`}),n.cpf_cnpj&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.cpf_cnpj})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail *"}),e.jsx("input",{type:"email",value:s.email,onChange:o=>p("email",o.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.email?"border-red-300":"border-gray-300"}`}),n.email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone *"}),e.jsx("input",{type:"text",value:s.telefone,onChange:o=>p("telefone",v.formatarTelefone(o.target.value)),placeholder:"(11) 99999-9999",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.telefone?"border-red-300":"border-gray-300"}`}),n.telefone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.telefone})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Endereço Completo"}),e.jsx("input",{type:"text",value:s.endereco,onChange:o=>p("endereco",o.target.value),placeholder:"Rua, número, bairro, cidade, estado",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mt-4 w-32",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CEP"}),e.jsx("input",{type:"text",value:s.cep,onChange:o=>p("cep",o.target.value.replace(/\D/g,"").replace(/(\d{5})(\d)/,"$1-$2")),placeholder:"00000-000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Empresa Envolvida (se aplicável)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome da Empresa"}),e.jsx("input",{type:"text",value:s.empresa_envolvida,onChange:o=>p("empresa_envolvida",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CNPJ da Empresa"}),e.jsx("input",{type:"text",value:s.cnpj_empresa,onChange:o=>p("cnpj_empresa",v.formatarCPFCNPJ(o.target.value)),placeholder:"00.000.000/0000-00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informações Adicionais"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Envolvido (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:s.valor_envolvido,onChange:o=>p("valor_envolvido",o.target.value),placeholder:"0,00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data da Ocorrência"}),e.jsx("input",{type:"date",value:s.data_ocorrencia,onChange:o=>p("data_ocorrencia",o.target.value),max:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Anexos"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:w,className:`block w-full text-sm text-gray-500
                file:mr-4 file:py-2 file:px-4
                file:rounded-full file:border-0
                file:text-sm file:font-semibold
                file:bg-blue-50 file:text-blue-700
                hover:file:bg-blue-100`}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Arquivos aceitos: PDF, JPG, PNG, DOC, DOCX (máximo 10MB cada)"}),n.anexos&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.anexos})]}),i.length>0&&e.jsx("div",{className:"space-y-2",children:i.map((o,l)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:o.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",(o.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx("button",{type:"button",onClick:()=>_(l),className:"text-red-600 hover:text-red-800",children:e.jsx($,{className:"h-5 w-5"})})]},l))})]}),e.jsxs("div",{className:"border-t pt-6 flex space-x-4",children:[e.jsx("button",{type:"submit",disabled:c,className:"flex-1 bg-blue-600 text-white py-3 px-6 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:c?"Enviando...":"Enviar Petição"}),r&&e.jsx("button",{type:"button",onClick:r,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Cancelar"})]})]})]})};export{R as P,v as p};
